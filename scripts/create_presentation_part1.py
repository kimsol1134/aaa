#!/usr/bin/env python3
"""
ë°œí‘œ_Part1_ë¬¸ì œì •ì˜_ë°_í•µì‹¬ë°œê²¬.ipynb ìƒì„± ìŠ¤í¬ë¦½íŠ¸

ê¸°ì¡´ ë…¸íŠ¸ë¶ì—ì„œ ì…€ì„ ì¶”ì¶œí•˜ê³  3-layer í•´ì„ ë° í†µê³„ ê²€ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
"""

import json
import sys
from pathlib import Path

def load_notebook(path):
    """ë…¸íŠ¸ë¶ JSON ë¡œë“œ"""
    with open(path, 'r', encoding='utf-8') as f:
        return json.load(f)

def create_markdown_cell(source):
    """ë§ˆí¬ë‹¤ìš´ ì…€ ìƒì„±"""
    if isinstance(source, str):
        source = [source]
    elif isinstance(source, list):
        # ê° ì¤„ì´ ì¤„ë°”ê¿ˆì„ í¬í•¨í•˜ì§€ ì•Šìœ¼ë©´ ì¶”ê°€
        source = [line if line.endswith('\n') else line + '\n' for line in source]

    return {
        "cell_type": "markdown",
        "metadata": {},
        "source": source
    }

def create_code_cell(source):
    """ì½”ë“œ ì…€ ìƒì„±"""
    if isinstance(source, str):
        source = [source]
    elif isinstance(source, list):
        source = [line if line.endswith('\n') else line + '\n' for line in source]

    return {
        "cell_type": "code",
        "execution_count": None,
        "metadata": {},
        "outputs": [],
        "source": source
    }

def extract_cell_by_index(notebook, index):
    """ë…¸íŠ¸ë¶ì—ì„œ íŠ¹ì • ì¸ë±ìŠ¤ì˜ ì…€ ì¶”ì¶œ"""
    if 0 <= index < len(notebook['cells']):
        return notebook['cells'][index].copy()
    return None

def main():
    # ê²½ë¡œ ì„¤ì •
    base_dir = Path(__file__).parent.parent
    nb1_path = base_dir / 'notebooks' / '01_ë„ë©”ì¸_ê¸°ë°˜_ë¶€ë„ì›ì¸_ë¶„ì„.ipynb'
    nb2_path = base_dir / 'notebooks' / '01_ì‹¬í™”_ì¬ë¬´_ë¶„ì„.ipynb'
    output_path = base_dir / 'notebooks' / 'ë°œí‘œ_Part1_ë¬¸ì œì •ì˜_ë°_í•µì‹¬ë°œê²¬.ipynb'

    # ê¸°ì¡´ ë…¸íŠ¸ë¶ ë¡œë“œ
    print("ğŸ“– ê¸°ì¡´ ë…¸íŠ¸ë¶ ë¡œë”©...")
    nb1 = load_notebook(nb1_path)
    nb2 = load_notebook(nb2_path)

    # ìƒˆ ë…¸íŠ¸ë¶ ìƒì„±
    new_cells = []

    # ====================================================================
    # SECTION: Opening (ë¬¸ì œ ì œê¸°)
    # ====================================================================
    print("âœï¸  Opening ì„¹ì…˜ ì‘ì„±...")

    new_cells.append(create_markdown_cell([
        "# ğŸ“˜ Part 1: ë¬¸ì œì •ì˜ ë° í•µì‹¬ë°œê²¬\n",
        "\n",
        "## í•œêµ­ ê¸°ì—… ë¶€ë„ ì˜ˆì¸¡: ê·¹ë„ë¡œ ë¶ˆê· í˜•í•œ ë°ì´í„°ì™€ì˜ ì „ìŸ\n",
        "\n"
    ]))

    new_cells.append(create_markdown_cell([
        "## ğŸ¯ ë¬¸ì œ ìƒí™©\n",
        "\n",
        "**50,000ê°œ ê¸°ì—…, 1.5% ë¶€ë„ìœ¨, ë¶ˆê· í˜• ë¹„ìœ¨ 1:66**\n",
        "\n",
        "### ì™œ ì´ê²ƒì´ ì–´ë ¤ìš´ ë¬¸ì œì¸ê°€?\n",
        "\n",
        "1. **ê·¹ë„ë¡œ ë¶ˆê· í˜•í•œ ë°ì´í„°**\n",
        "   - ì •ìƒ ê¸°ì—…: 98.49% (49,349ê°œ)\n",
        "   - ë¶€ë„ ê¸°ì—…: 1.51% (756ê°œ)\n",
        "   - ë‹¨ìˆœíˆ \"ëª¨ë“  ê¸°ì—…ì´ ì •ìƒ\"ì´ë¼ê³  ì˜ˆì¸¡í•´ë„ ì •í™•ë„ 98.49%\n",
        "\n",
        "2. **ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸**\n",
        "   - Type I Error (False Positive): ì •ìƒ ê¸°ì—…ì„ ë¶€ë„ë¡œ ì˜ëª» ì˜ˆì¸¡ â†’ ëŒ€ì¶œ ê±°ì ˆ, ê¸°íšŒ ì†ì‹¤\n",
        "   - **Type II Error (False Negative): ë¶€ë„ ê¸°ì—…ì„ ì •ìƒìœ¼ë¡œ ì˜ëª» ì˜ˆì¸¡ â†’ ê¸ˆìœµ ì†ì‹¤, ì‹œìŠ¤í…œ ë¦¬ìŠ¤í¬** âš ï¸\n",
        "\n",
        "3. **ëª©í‘œ**\n",
        "   - ë¶€ë„ ê¸°ì—…ì„ ë†“ì¹˜ì§€ ì•Šìœ¼ë©´ì„œ (Recall â†‘)\n",
        "   - ì˜¤íƒì„ ìµœì†Œí™” (Precision â†‘)\n",
        "   - PR-AUCë¥¼ í•µì‹¬ ì§€í‘œë¡œ ì‚¬ìš©\n",
        "\n"
    ]))

    # ====================================================================
    # SECTION: í™˜ê²½ ì„¤ì • ë° ë°ì´í„° ë¡œë”©
    # ====================================================================
    print("âœï¸  í™˜ê²½ ì„¤ì • ë° ë°ì´í„° ë¡œë”© ì„¹ì…˜ ì‘ì„±...")

    new_cells.append(create_markdown_cell([
        "---\n",
        "\n",
        "## 1. í™˜ê²½ ì„¤ì • ë° ë°ì´í„° ë¡œë”©\n",
        "\n"
    ]))

    # 01_ë„ë©”ì¸_ê¸°ë°˜_ë¶€ë„ì›ì¸_ë¶„ì„.ipynbì—ì„œ í™˜ê²½ ì„¤ì • ì…€ ì¶”ì¶œ (ì²« ë²ˆì§¸ ì½”ë“œ ì…€)
    for i, cell in enumerate(nb1['cells']):
        if cell['cell_type'] == 'code' and 'í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬' in ''.join(cell['source']):
            new_cells.append(cell.copy())
            break

    # ë°ì´í„° ë¡œë”© ì…€ ì¶”ì¶œ
    for i, cell in enumerate(nb1['cells']):
        if cell['cell_type'] == 'code' and 'pd.read_csv' in ''.join(cell['source']) and 'ê¸°ì—…ì‹ ìš©í‰ê°€ì •ë³´' in ''.join(cell['source']):
            new_cells.append(cell.copy())
            break

    # ====================================================================
    # SECTION: íƒ€ê²Ÿ ë³€ìˆ˜ ë° ë¶ˆê· í˜• ë¶„ì„
    # ====================================================================
    print("âœï¸  íƒ€ê²Ÿ ë³€ìˆ˜ ë¶„ì„ ì„¹ì…˜ ì‘ì„±...")

    new_cells.append(create_markdown_cell([
        "---\n",
        "\n",
        "## 2. íƒ€ê²Ÿ ë³€ìˆ˜ ë° ë¶ˆê· í˜• ë¶„ì„\n",
        "\n",
        "### í•µì‹¬ ì§ˆë¬¸: \"ì–¼ë§ˆë‚˜ ë¶ˆê· í˜•í•œê°€?\"\n",
        "\n"
    ]))

    # íƒ€ê²Ÿ ë³€ìˆ˜ ë¶„ì„ ì…€ ì¶”ì¶œ
    for i, cell in enumerate(nb1['cells']):
        if cell['cell_type'] == 'code' and 'target_col' in ''.join(cell['source']) and 'ë¶ˆê· í˜• ë¹„ìœ¨' in ''.join(cell['source']):
            new_cells.append(cell.copy())
            break

    # 3-layer í•´ì„ ì¶”ê°€
    new_cells.append(create_markdown_cell([
        "### ğŸ“Š í†µê³„ì  ì‚¬ì‹¤\n",
        "\n",
        "- **ì •ìƒ ê¸°ì—…: 98.49%** (49,349ê°œ)\n",
        "- **ë¶€ë„ ê¸°ì—…: 1.51%** (756ê°œ)\n",
        "- **ë¶ˆê· í˜• ë¹„ìœ¨: 1:66**\n",
        "\n",
        "### ğŸ’¡ ì¬ë¬´ í•´ì„\n",
        "\n",
        "1. **ë§¤ìš° ë‚®ì€ ë¶€ë„ìœ¨**: í•œêµ­ ê¸°ì—…ì˜ 1ë…„ ë‚´ ë¶€ë„ìœ¨ì€ 1.5%ë¡œ, ëŒ€ë¶€ë¶„ì˜ ê¸°ì—…ì´ ì¬ë¬´ì ìœ¼ë¡œ ê±´ì „í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\n",
        "2. **ë°ì´í„° ë¶ˆê· í˜•ì˜ ì˜ë¯¸**: ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì€ ë‹¤ìˆ˜ í´ë˜ìŠ¤(ì •ìƒ ê¸°ì—…)ì— í¸í–¥ë  ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.\n",
        "3. **ì‹¤ë¬´ì  ì¤‘ìš”ì„±**: 756ê°œì˜ ë¶€ë„ ê¸°ì—…ì„ ì •í™•íˆ ì‹ë³„í•˜ëŠ” ê²ƒì´ 49,000ê°œ ì •ìƒ ê¸°ì—…ì„ ë¶„ë¥˜í•˜ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ì¤‘ìš”í•©ë‹ˆë‹¤.\n",
        "\n",
        "### â¡ï¸ ë‹¤ìŒ ì•¡ì…˜\n",
        "\n",
        "1. **í‰ê°€ ì§€í‘œ ì„ íƒ**: ì •í™•ë„(Accuracy)ê°€ ì•„ë‹Œ **PR-AUC, F2-Score**ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.\n",
        "2. **ìƒ˜í”Œë§ ì „ëµ**: SMOTE, Tomek Links ë“± ë¶ˆê· í˜• ì²˜ë¦¬ ê¸°ë²•ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.\n",
        "3. **ë¹„ì¦ˆë‹ˆìŠ¤ ê´€ì **: Type II Error(ë¶€ë„ ë¯¸íƒì§€)ë¥¼ ìµœì†Œí™”í•˜ëŠ” ê²ƒì´ ìµœìš°ì„  ëª©í‘œì…ë‹ˆë‹¤.\n",
        "\n"
    ]))

    # ====================================================================
    # SECTION: ì²« ë²ˆì§¸ ë°œê²¬ - ìœ ë™ì„±ì´ í•µì‹¬
    # ====================================================================
    print("âœï¸  ìœ ë™ì„± ë¶„ì„ ì„¹ì…˜ ì‘ì„±...")

    new_cells.append(create_markdown_cell([
        "---\n",
        "\n",
        "## 3. ì²« ë²ˆì§¸ ë°œê²¬: ìœ ë™ì„±ì´ í•µì‹¬\n",
        "\n",
        "### í•µì‹¬ ì§ˆë¬¸: \"ë¶€ë„ ê¸°ì—…ê³¼ ì •ìƒ ê¸°ì—…ì˜ ê°€ì¥ í° ì°¨ì´ëŠ”?\"\n",
        "\n"
    ]))

    # ìœ ë™ë¹„ìœ¨ ë¶„ì„ ì…€ ì¶”ì¶œ
    for i, cell in enumerate(nb1['cells']):
        if cell['cell_type'] == 'code' and 'ìœ ë™ë¹„ìœ¨ ë° ë‹¹ì¢Œë¹„ìœ¨ ë¶„ì„' in ''.join(cell['source']):
            new_cells.append(cell.copy())
            break

    # í˜„ê¸ˆë¹„ìœ¨ ë¶„ì„ ì…€ ì¶”ì¶œ
    for i, cell in enumerate(nb1['cells']):
        if cell['cell_type'] == 'code' and 'í˜„ê¸ˆë¹„ìœ¨ ê³„ì‚° ë° ë¶„ì„' in ''.join(cell['source']):
            # ì´ ì…€ì´ ë„ˆë¬´ ê¸¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê°„ì†Œí™”ëœ ë²„ì „ ì‘ì„±
            new_cells.append(create_code_cell([
                "# í˜„ê¸ˆë¹„ìœ¨ ê³„ì‚° ë° ë¶„ì„\n",
                "print(\"ğŸ’° í˜„ê¸ˆë¹„ìœ¨ ê³„ì‚° ë° ë¶„ì„\")\n",
                "print(\"=\"*80)\n",
                "\n",
                "# í˜„ê¸ˆ ê´€ë ¨ ì»¬ëŸ¼ í™•ì¸\n",
                "if 'í˜„ê¸ˆ' in df.columns and 'í˜„ê¸ˆë“±ê°€ë¬¼' in df.columns and 'ìœ ë™ë¶€ì±„' in df.columns:\n",
                "    # í˜„ê¸ˆë¹„ìœ¨ = (í˜„ê¸ˆ + í˜„ê¸ˆë“±ê°€ë¬¼) / ìœ ë™ë¶€ì±„\n",
                "    df['ì´í˜„ê¸ˆ'] = df['í˜„ê¸ˆ'].fillna(0) + df['í˜„ê¸ˆë“±ê°€ë¬¼'].fillna(0)\n",
                "    df['í˜„ê¸ˆë¹„ìœ¨'] = df['ì´í˜„ê¸ˆ'] / (df['ìœ ë™ë¶€ì±„'] + 1)  # 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€\n",
                "    df['í˜„ê¸ˆë¹„ìœ¨'] = df['í˜„ê¸ˆë¹„ìœ¨'].replace([np.inf, -np.inf], np.nan)\n",
                "    \n",
                "    print(f\"âœ… í˜„ê¸ˆë¹„ìœ¨ ê³„ì‚° ì™„ë£Œ\")\n",
                "    print(f\"  - í‰ê· : {df['í˜„ê¸ˆë¹„ìœ¨'].mean():.3f}\")\n",
                "    print(f\"  - ì¤‘ì•™ê°’: {df['í˜„ê¸ˆë¹„ìœ¨'].median():.3f}\")\n",
                "    \n",
                "    # ë¶€ë„ê¸°ì—… vs ì •ìƒê¸°ì—… ë¹„êµ\n",
                "    if target_col in df.columns:\n",
                "        normal_cash = df[df[target_col] == 0]['í˜„ê¸ˆë¹„ìœ¨'].median()\n",
                "        bankrupt_cash = df[df[target_col] == 1]['í˜„ê¸ˆë¹„ìœ¨'].median()\n",
                "        \n",
                "        print(f\"\\nğŸ’§ í˜„ê¸ˆë¹„ìœ¨ ë¹„êµ\")\n",
                "        print(\"-\"*60)\n",
                "        print(f\"ì •ìƒê¸°ì—…(ì¤‘ì•™ê°’): {normal_cash:.3f}\")\n",
                "        print(f\"ë¶€ë„ê¸°ì—…(ì¤‘ì•™ê°’): {bankrupt_cash:.3f}\")\n",
                "        print(f\"ì°¨ì´ìœ¨: {(normal_cash - bankrupt_cash) / normal_cash * 100:.1f}%\")\n",
                "        \n",
                "        # ì‹œê°í™”\n",
                "        import plotly.graph_objects as go\n",
                "        \n",
                "        fig = go.Figure()\n",
                "        fig.add_trace(go.Bar(\n",
                "            name='ì •ìƒê¸°ì—…',\n",
                "            x=['í˜„ê¸ˆë¹„ìœ¨'],\n",
                "            y=[normal_cash],\n",
                "            text=[f\"{normal_cash:.3f}\"],\n",
                "            textposition='outside',\n",
                "            marker_color='lightblue'\n",
                "        ))\n",
                "        fig.add_trace(go.Bar(\n",
                "            name='ë¶€ë„ê¸°ì—…',\n",
                "            x=['í˜„ê¸ˆë¹„ìœ¨'],\n",
                "            y=[bankrupt_cash],\n",
                "            text=[f\"{bankrupt_cash:.3f}\"],\n",
                "            textposition='outside',\n",
                "            marker_color='salmon'\n",
                "        ))\n",
                "        \n",
                "        fig.update_layout(\n",
                "            title='ì •ìƒê¸°ì—… vs ë¶€ë„ê¸°ì—…: í˜„ê¸ˆë¹„ìœ¨ ë¹„êµ',\n",
                "            yaxis_title='í˜„ê¸ˆë¹„ìœ¨',\n",
                "            barmode='group',\n",
                "            height=500\n",
                "        )\n",
                "        fig.show()\n",
                "else:\n",
                "    print(\"âš ï¸ í˜„ê¸ˆ ê´€ë ¨ ì»¬ëŸ¼ì´ ë¶€ì¡±í•©ë‹ˆë‹¤\")\n",
                "\n"
            ]))
            break

    # í†µê³„ ê²€ì • ì¶”ê°€
    new_cells.append(create_markdown_cell([
        "### ğŸ“ˆ í†µê³„ì  ê²€ì •: ì´ ì°¨ì´ê°€ ìš°ì—°ì¸ê°€?\n",
        "\n",
        "Mann-Whitney U testì™€ Cliff's deltaë¡œ íš¨ê³¼ í¬ê¸°ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤.\n",
        "\n"
    ]))

    new_cells.append(create_code_cell([
        "# ìœ ë™ì„± ì§€í‘œì˜ í†µê³„ì  ìœ ì˜ì„± ê²€ì •\n",
        "from scipy.stats import mannwhitneyu\n",
        "\n",
        "print(\"ğŸ“Š ìœ ë™ì„± ì§€í‘œ í†µê³„ì  ê²€ì •\")\n",
        "print(\"=\"*80)\n",
        "\n",
        "# Mann-Whitney U test ë° Cliff's delta\n",
        "liquidity_metrics = ['ìœ ë™ë¹„ìœ¨', 'ë‹¹ì¢Œë¹„ìœ¨']\n",
        "if 'í˜„ê¸ˆë¹„ìœ¨' in df.columns:\n",
        "    liquidity_metrics.append('í˜„ê¸ˆë¹„ìœ¨')\n",
        "\n",
        "for metric in liquidity_metrics:\n",
        "    if metric in df.columns and target_col in df.columns:\n",
        "        normal = df[df[target_col] == 0][metric].dropna()\n",
        "        bankrupt = df[df[target_col] == 1][metric].dropna()\n",
        "        \n",
        "        if len(normal) > 0 and len(bankrupt) > 0:\n",
        "            # Mann-Whitney U test\n",
        "            u_stat, p_value = mannwhitneyu(normal, bankrupt, alternative='two-sided')\n",
        "            \n",
        "            # Cliff's delta (íš¨ê³¼ í¬ê¸°)\n",
        "            n1, n2 = len(normal), len(bankrupt)\n",
        "            cliff_delta = (u_stat - n1*n2/2) / (n1*n2)\n",
        "            \n",
        "            print(f\"\\n{metric}:\")\n",
        "            print(f\"  â€¢ Mann-Whitney U test: p = {p_value:.2e}\")\n",
        "            print(f\"  â€¢ Cliff's delta = {cliff_delta:.3f}\")\n",
        "            \n",
        "            # íš¨ê³¼ í¬ê¸° í•´ì„\n",
        "            if abs(cliff_delta) < 0.147:\n",
        "                effect = \"ì‘ìŒ (negligible)\"\n",
        "            elif abs(cliff_delta) < 0.33:\n",
        "                effect = \"ì‘ìŒ (small)\"\n",
        "            elif abs(cliff_delta) < 0.474:\n",
        "                effect = \"ì¤‘ê°„ (medium)\"\n",
        "            else:\n",
        "                effect = \"í¼ (large)\"\n",
        "            \n",
        "            print(f\"  â€¢ íš¨ê³¼ í¬ê¸°: {effect}\")\n",
        "            \n",
        "            if p_value < 0.001:\n",
        "                print(f\"  â€¢ ê²°ë¡ : *** ë§¤ìš° ìœ ì˜í•œ ì°¨ì´ (p < 0.001) ***\")\n",
        "            elif p_value < 0.05:\n",
        "                print(f\"  â€¢ ê²°ë¡ : ìœ ì˜í•œ ì°¨ì´ (p < 0.05)\")\n",
        "            else:\n",
        "                print(f\"  â€¢ ê²°ë¡ : ìœ ì˜í•œ ì°¨ì´ ì—†ìŒ (p â‰¥ 0.05)\")\n",
        "\n"
    ]))

    # 3-layer í•´ì„
    new_cells.append(create_markdown_cell([
        "### ğŸ“Š í†µê³„ì  ì‚¬ì‹¤\n",
        "\n",
        "- **ìœ ë™ë¹„ìœ¨**: ì •ìƒ ê¸°ì—… 1.81 vs ë¶€ë„ ê¸°ì—… 1.44 (20% ì°¨ì´)\n",
        "- **ë‹¹ì¢Œë¹„ìœ¨**: ì •ìƒ ê¸°ì—… 1.33 vs ë¶€ë„ ê¸°ì—… 0.92 (30% ì°¨ì´)\n",
        "- **í˜„ê¸ˆë¹„ìœ¨**: ì •ìƒ ê¸°ì—…ê³¼ ë¶€ë„ ê¸°ì—… ê°„ ìœ ì˜í•œ ì°¨ì´ (p < 0.001)\n",
        "- **Cliff's delta**: ì¤‘ê°„~í° íš¨ê³¼ í¬ê¸°\n",
        "\n",
        "### ğŸ’¡ ì¬ë¬´ í•´ì„\n",
        "\n",
        "1. **ìœ ë™ì„±ì€ ë¶€ë„ì˜ ê°€ì¥ ê°•ë ¥í•œ ì¡°ê¸° ê²½ë³´ ì‹ í˜¸**\n",
        "   - ë¶€ë„ ê¸°ì—…ì€ ë‹¨ê¸° ë¶€ì±„ë¥¼ ê°šì„ í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\n",
        "   - ë‹¹ì¢Œë¹„ìœ¨(ì¬ê³  ì œì™¸)ì´ 1 ë¯¸ë§Œì´ë©´ ì¦‰ê°ì ì¸ ì§€ê¸‰ ë¶ˆëŠ¥ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.\n",
        "\n",
        "2. **í˜„ê¸ˆì€ ì™•ì´ë‹¤ (Cash is King)**\n",
        "   - ì¬ë¬´ì œí‘œìƒ ì´ìµì´ ìˆì–´ë„ í˜„ê¸ˆì´ ì—†ìœ¼ë©´ ë¶€ë„ê°€ ë‚©ë‹ˆë‹¤.\n",
        "   - \"ì´ìµì€ ì˜ê²¬, í˜„ê¸ˆì€ ì‚¬ì‹¤\" (Profit is an opinion, cash is a fact)\n",
        "\n",
        "3. **ì—…ì¢…ë³„ ì°¨ì´**\n",
        "   - ì œì¡°ì—…: ì¬ê³  ë¹„ì¤‘ì´ ë†’ì•„ ë‹¹ì¢Œë¹„ìœ¨ì´ ë‚®ì„ ìˆ˜ ìˆìŒ\n",
        "   - ì„œë¹„ìŠ¤ì—…: ì¬ê³ ê°€ ì ì–´ ìœ ë™ë¹„ìœ¨ â‰ˆ ë‹¹ì¢Œë¹„ìœ¨\n",
        "\n",
        "### â¡ï¸ ë‹¤ìŒ ì•¡ì…˜\n",
        "\n",
        "1. **ë³µí•© ìœ ë™ì„± ì§€í‘œ ìƒì„±** (Part 2ì—ì„œ ìˆ˜í–‰)\n",
        "   - í˜„ê¸ˆì†Œì§„ì¼ìˆ˜ (Cash Burn Rate) = í˜„ê¸ˆ / (ì›”í‰ê·  ì˜ì—…ë¹„ìš©)\n",
        "   - ì¦‰ê°ì§€ê¸‰ëŠ¥ë ¥ = í˜„ê¸ˆ / ë‹¨ê¸°ì°¨ì…ê¸ˆ\n",
        "   - ìš´ì „ìë³¸ ê±´ì „ì„± = (ìœ ë™ìì‚° - ìœ ë™ë¶€ì±„) / ì´ìì‚°\n",
        "\n",
        "2. **ì—…ì¢…ë³„ ìƒëŒ€ ë¹„ìœ¨**\n",
        "   - ì ˆëŒ€ê°’ì´ ì•„ë‹Œ ì—…ì¢… ì¤‘ì•™ê°’ ëŒ€ë¹„ ìƒëŒ€ ë¹„ìœ¨ ì‚¬ìš©\n",
        "   - ì˜ˆ: (ê¸°ì—… ìœ ë™ë¹„ìœ¨ - ì—…ì¢… ì¤‘ì•™ê°’) / ì—…ì¢… í‘œì¤€í¸ì°¨\n",
        "\n",
        "3. **ì‹œê³„ì—´ ë³€í™”ìœ¨**\n",
        "   - í˜„ì¬ ë°ì´í„°ëŠ” ì‹œì  ìŠ¤ëƒ…ìƒ·ì´ì§€ë§Œ, í–¥í›„ ì‹œê³„ì—´ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ë³€í™”ìœ¨ ì¶”ê°€\n",
        "\n"
    ]))

    # ====================================================================
    # SECTION: ë‘ ë²ˆì§¸ ë°œê²¬ - ì—…ì¢…ë³„ ì°¨ì´
    # ====================================================================
    print("âœï¸  ì—…ì¢…ë³„ ë¶„ì„ ì„¹ì…˜ ì‘ì„±...")

    new_cells.append(create_markdown_cell([
        "---\n",
        "\n",
        "## 4. ë‘ ë²ˆì§¸ ë°œê²¬: ì—…ì¢…ë³„ ë¶€ë„ìœ¨ ì°¨ì´\n",
        "\n",
        "### í•µì‹¬ ì§ˆë¬¸: \"ëª¨ë“  ì—…ì¢…ì´ ë™ì¼í•œ ë¶€ë„ ìœ„í—˜ì„ ê°€ì§€ëŠ”ê°€?\"\n",
        "\n"
    ]))

    # ì—…ì¢…ë³„ ë¶„ì„ ì½”ë“œ ì‘ì„±
    new_cells.append(create_code_cell([
        "# ì—…ì¢…ë³„ ë¶€ë„ìœ¨ ë¶„ì„\n",
        "print(\"ğŸ­ ì—…ì¢…ë³„ ë¶€ë„ìœ¨ ë¶„ì„\")\n",
        "print(\"=\"*80)\n",
        "\n",
        "industry_col = 'ì—…ì¢…(ì¤‘ë¶„ë¥˜)'\n",
        "\n",
        "if industry_col in df.columns and target_col in df.columns:\n",
        "    # ì—…ì¢…ë³„ ë¶€ë„ìœ¨ ê³„ì‚°\n",
        "    industry_stats = df.groupby(industry_col)[target_col].agg([\n",
        "        ('ê¸°ì—…ìˆ˜', 'count'),\n",
        "        ('ë¶€ë„ìˆ˜', 'sum'),\n",
        "        ('ë¶€ë„ìœ¨', 'mean')\n",
        "    ]).reset_index()\n",
        "    \n",
        "    industry_stats['ë¶€ë„ìœ¨(%)'] = industry_stats['ë¶€ë„ìœ¨'] * 100\n",
        "    industry_stats = industry_stats.sort_values('ë¶€ë„ìœ¨(%)', ascending=False)\n",
        "    \n",
        "    # ìƒìœ„ 10ê°œ ì—…ì¢… ì¶œë ¥\n",
        "    print(\"\\nğŸ“ˆ ë¶€ë„ìœ¨ ìƒìœ„ 10ê°œ ì—…ì¢…\")\n",
        "    print(\"-\"*80)\n",
        "    print(industry_stats[['ì—…ì¢…(ì¤‘ë¶„ë¥˜)', 'ê¸°ì—…ìˆ˜', 'ë¶€ë„ìˆ˜', 'ë¶€ë„ìœ¨(%)']].head(10).to_string(index=False))\n",
        "    \n",
        "    print(\"\\nğŸ“‰ ë¶€ë„ìœ¨ í•˜ìœ„ 10ê°œ ì—…ì¢…\")\n",
        "    print(\"-\"*80)\n",
        "    print(industry_stats[['ì—…ì¢…(ì¤‘ë¶„ë¥˜)', 'ê¸°ì—…ìˆ˜', 'ë¶€ë„ìˆ˜', 'ë¶€ë„ìœ¨(%)']].tail(10).to_string(index=False))\n",
        "    \n",
        "    # ì‹œê°í™” (ìƒìœ„ 15ê°œ)\n",
        "    import plotly.graph_objects as go\n",
        "    \n",
        "    top15 = industry_stats.head(15)\n",
        "    \n",
        "    fig = go.Figure()\n",
        "    fig.add_trace(go.Bar(\n",
        "        y=top15['ì—…ì¢…(ì¤‘ë¶„ë¥˜)'],\n",
        "        x=top15['ë¶€ë„ìœ¨(%)'],\n",
        "        orientation='h',\n",
        "        text=[f\"{rate:.2f}%\" for rate in top15['ë¶€ë„ìœ¨(%)']],\n",
        "        textposition='outside',\n",
        "        marker_color='coral',\n",
        "        hovertemplate='ì—…ì¢…: %{y}<br>ë¶€ë„ìœ¨: %{x:.2f}%<br>ê¸°ì—…ìˆ˜: %{customdata[0]}<br>ë¶€ë„ìˆ˜: %{customdata[1]}<extra></extra>',\n",
        "        customdata=top15[['ê¸°ì—…ìˆ˜', 'ë¶€ë„ìˆ˜']].values\n",
        "    ))\n",
        "    \n",
        "    # ì „ì²´ í‰ê·  ë¶€ë„ìœ¨ ì„ \n",
        "    overall_rate = df[target_col].mean() * 100\n",
        "    fig.add_vline(x=overall_rate, line_dash=\"dash\", line_color=\"red\", line_width=2,\n",
        "                 annotation_text=f\"ì „ì²´ í‰ê· : {overall_rate:.2f}%\",\n",
        "                 annotation_position=\"top right\")\n",
        "    \n",
        "    fig.update_layout(\n",
        "        title='ì—…ì¢…ë³„ ë¶€ë„ìœ¨ ìƒìœ„ 15ê°œ',\n",
        "        xaxis_title='ë¶€ë„ìœ¨ (%)',\n",
        "        yaxis_title='ì—…ì¢…',\n",
        "        height=600,\n",
        "        margin=dict(l=200, r=150, t=80, b=80)\n",
        "    )\n",
        "    fig.show()\n",
        "    \n",
        "    # ë¶€ë„ìœ¨ ë²”ìœ„\n",
        "    print(f\"\\nğŸ“Š ì—…ì¢…ë³„ ë¶€ë„ìœ¨ ë²”ìœ„\")\n",
        "    print(f\"  â€¢ ìµœëŒ€: {industry_stats['ë¶€ë„ìœ¨(%)'].max():.2f}%\")\n",
        "    print(f\"  â€¢ ìµœì†Œ: {industry_stats['ë¶€ë„ìœ¨(%)'].min():.2f}%\")\n",
        "    print(f\"  â€¢ í‰ê· : {industry_stats['ë¶€ë„ìœ¨(%)'].mean():.2f}%\")\n",
        "    print(f\"  â€¢ ì°¨ì´ ë°°ìˆ˜: {industry_stats['ë¶€ë„ìœ¨(%)'].max() / max(industry_stats['ë¶€ë„ìœ¨(%)'].min(), 0.01):.1f}ë°°\")\n",
        "else:\n",
        "    print(\"âš ï¸ ì—…ì¢… ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\")\n",
        "\n"
    ]))

    # Chi-square test ì¶”ê°€
    new_cells.append(create_markdown_cell([
        "### ğŸ“ˆ í†µê³„ì  ê²€ì •: ì—…ì¢…ê³¼ ë¶€ë„ëŠ” ë…ë¦½ì ì¸ê°€?\n",
        "\n",
        "Chi-square testë¡œ ì—…ì¢…ê³¼ ë¶€ë„ ì—¬ë¶€ì˜ ë…ë¦½ì„±ì„ ê²€ì •í•©ë‹ˆë‹¤.\n",
        "\n"
    ]))

    new_cells.append(create_code_cell([
        "# Chi-square test: ì—…ì¢…ê³¼ ë¶€ë„ ì—¬ë¶€ì˜ ë…ë¦½ì„± ê²€ì •\n",
        "from scipy.stats import chi2_contingency\n",
        "\n",
        "print(\"ğŸ“Š Chi-square ë…ë¦½ì„± ê²€ì •\")\n",
        "print(\"=\"*80)\n",
        "\n",
        "if industry_col in df.columns and target_col in df.columns:\n",
        "    # êµì°¨í‘œ ìƒì„±\n",
        "    contingency_table = pd.crosstab(df[industry_col], df[target_col])\n",
        "    \n",
        "    # Chi-square test\n",
        "    chi2, p_value, dof, expected = chi2_contingency(contingency_table)\n",
        "    \n",
        "    print(f\"\\nê·€ë¬´ê°€ì„¤ (H0): ì—…ì¢…ê³¼ ë¶€ë„ ì—¬ë¶€ëŠ” ë…ë¦½ì ì´ë‹¤\")\n",
        "    print(f\"ëŒ€ë¦½ê°€ì„¤ (H1): ì—…ì¢…ê³¼ ë¶€ë„ ì—¬ë¶€ëŠ” ë…ë¦½ì ì´ì§€ ì•Šë‹¤ (ì—°ê´€ì„±ì´ ìˆë‹¤)\")\n",
        "    print(f\"\\nê²°ê³¼:\")\n",
        "    print(f\"  â€¢ Chi-square statistic: {chi2:.2f}\")\n",
        "    print(f\"  â€¢ p-value: {p_value:.2e}\")\n",
        "    print(f\"  â€¢ Degrees of freedom: {dof}\")\n",
        "    \n",
        "    if p_value < 0.001:\n",
        "        print(f\"\\nâœ… ê²°ë¡ : ì—…ì¢…ê³¼ ë¶€ë„ ì—¬ë¶€ëŠ” ë§¤ìš° ìœ ì˜í•œ ì—°ê´€ì„±ì´ ìˆìŠµë‹ˆë‹¤ (p < 0.001)\")\n",
        "        print(f\"   â†’ ì—…ì¢… ì •ë³´ëŠ” ë¶€ë„ ì˜ˆì¸¡ì— ì¤‘ìš”í•œ ë³€ìˆ˜ì…ë‹ˆë‹¤.\")\n",
        "    elif p_value < 0.05:\n",
        "        print(f\"\\nâœ… ê²°ë¡ : ì—…ì¢…ê³¼ ë¶€ë„ ì—¬ë¶€ëŠ” ìœ ì˜í•œ ì—°ê´€ì„±ì´ ìˆìŠµë‹ˆë‹¤ (p < 0.05)\")\n",
        "    else:\n",
        "        print(f\"\\nâŒ ê²°ë¡ : ì—…ì¢…ê³¼ ë¶€ë„ ì—¬ë¶€ëŠ” ë…ë¦½ì ì…ë‹ˆë‹¤ (p â‰¥ 0.05)\")\n",
        "    \n",
        "    # CramÃ©r's V (íš¨ê³¼ í¬ê¸°)\n",
        "    n = contingency_table.sum().sum()\n",
        "    min_dim = min(contingency_table.shape[0] - 1, contingency_table.shape[1] - 1)\n",
        "    cramers_v = np.sqrt(chi2 / (n * min_dim))\n",
        "    \n",
        "    print(f\"\\n  â€¢ CramÃ©r's V (íš¨ê³¼ í¬ê¸°): {cramers_v:.3f}\")\n",
        "    if cramers_v < 0.1:\n",
        "        print(f\"    â†’ íš¨ê³¼ í¬ê¸°: ë§¤ìš° ì‘ìŒ\")\n",
        "    elif cramers_v < 0.3:\n",
        "        print(f\"    â†’ íš¨ê³¼ í¬ê¸°: ì‘ìŒ\")\n",
        "    elif cramers_v < 0.5:\n",
        "        print(f\"    â†’ íš¨ê³¼ í¬ê¸°: ì¤‘ê°„\")\n",
        "    else:\n",
        "        print(f\"    â†’ íš¨ê³¼ í¬ê¸°: í¼\")\n",
        "else:\n",
        "    print(\"âš ï¸ ì—…ì¢… ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\")\n",
        "\n"
    ]))

    # 3-layer í•´ì„
    new_cells.append(create_markdown_cell([
        "### ğŸ“Š í†µê³„ì  ì‚¬ì‹¤\n",
        "\n",
        "- **ì—…ì¢…ë³„ ë¶€ë„ìœ¨ ë²”ìœ„**: ìµœì†Œ 0% ~ ìµœëŒ€ 5% ì´ìƒ\n",
        "- **ì—…ì¢… ê°„ ì°¨ì´**: ìµœëŒ€ 2~3ë°° ì°¨ì´\n",
        "- **Chi-square test**: ì—…ì¢…ê³¼ ë¶€ë„ëŠ” ìœ ì˜í•œ ì—°ê´€ì„± (p < 0.001)\n",
        "\n",
        "### ğŸ’¡ ì¬ë¬´ í•´ì„\n",
        "\n",
        "1. **ì—…ì¢…ë³„ ë¦¬ìŠ¤í¬ê°€ ë‹¤ë¥´ë‹¤**\n",
        "   - ì œì¡°ì—…, ê±´ì„¤ì—…: ë†’ì€ ê³ ì •ë¹„ìš©, ê²½ê¸° ë¯¼ê°ë„ ë†’ìŒ\n",
        "   - ì„œë¹„ìŠ¤ì—…, IT: ë‚®ì€ ê³ ì •ë¹„ìš©, ìƒëŒ€ì ìœ¼ë¡œ ì•ˆì •ì \n",
        "\n",
        "2. **ì‚°ì—… ìƒëª…ì£¼ê¸°**\n",
        "   - ì„±ìˆ™ ì‚°ì—…: ê²½ìŸ ì‹¬í™”, ë§ˆì§„ ì••ë°• â†’ ë¶€ë„ìœ¨ ì¦ê°€\n",
        "   - ì„±ì¥ ì‚°ì—…: ë†’ì€ ìˆ˜ìµì„±, íˆ¬ì ìœ ì… â†’ ë¶€ë„ìœ¨ ë‚®ìŒ\n",
        "\n",
        "3. **í•œêµ­ ê²½ì œ êµ¬ì¡°**\n",
        "   - ì œì¡°ì—… ì¤‘ì‹¬ ê²½ì œ (ì‚¼ì„±, í˜„ëŒ€ì°¨, SK ë“±)\n",
        "   - ëŒ€ê¸°ì—… ì¤‘ì‹¬ ìƒíƒœê³„ â†’ ì¤‘ì†Œê¸°ì—… ë¦¬ìŠ¤í¬ ë†’ìŒ\n",
        "\n",
        "### â¡ï¸ ë‹¤ìŒ ì•¡ì…˜\n",
        "\n",
        "1. **ì—…ì¢… ë”ë¯¸ ë³€ìˆ˜ ìƒì„±**\n",
        "   - One-hot encodingìœ¼ë¡œ ì—…ì¢… ì •ë³´ í¬í•¨\n",
        "\n",
        "2. **ì—…ì¢…ë³„ ìƒëŒ€ ì§€í‘œ**\n",
        "   - ì—…ì¢… í‰ê·  ëŒ€ë¹„ ì¬ë¬´ ë¹„ìœ¨\n",
        "   - ì˜ˆ: (ê¸°ì—… ë¶€ì±„ë¹„ìœ¨ - ì—…ì¢… í‰ê· ) / ì—…ì¢… í‘œì¤€í¸ì°¨\n",
        "\n",
        "3. **ì—…ì¢…ë³„ ì„ê³„ê°’**\n",
        "   - ì œì¡°ì—…ê³¼ ì„œë¹„ìŠ¤ì—…ì˜ \"ê±´ì „í•œ ë¶€ì±„ë¹„ìœ¨\"ì€ ë‹¤ë¦„\n",
        "   - ì—…ì¢…ë³„ ë§ì¶¤í˜• ì„ê³„ê°’ ì„¤ì •\n",
        "\n"
    ]))

    # ====================================================================
    # SECTION: ì„¸ ë²ˆì§¸ ë°œê²¬ - í•œêµ­ ì‹œì¥ íŠ¹ìˆ˜ì„±
    # ====================================================================
    print("âœï¸  í•œêµ­ ì‹œì¥ íŠ¹ìˆ˜ì„± ì„¹ì…˜ ì‘ì„±...")

    new_cells.append(create_markdown_cell([
        "---\n",
        "\n",
        "## 5. ì„¸ ë²ˆì§¸ ë°œê²¬: í•œêµ­ ì‹œì¥ íŠ¹ìˆ˜ì„± (ì™¸ê° ì—¬ë¶€)\n",
        "\n",
        "### í•µì‹¬ ì§ˆë¬¸: \"ì™¸ë¶€ê°ì‚¬ë¥¼ ë°›ëŠ” ê¸°ì—…ì´ ë” ì•ˆì „í•œê°€?\"\n",
        "\n"
    ]))

    # ì™¸ê° ì—¬ë¶€ ë¶„ì„
    new_cells.append(create_code_cell([
        "# ì™¸ê° ì—¬ë¶€ì™€ ë¶€ë„ìœ¨ ë¶„ì„\n",
        "print(\"ğŸ” ì™¸ë¶€ê°ì‚¬(ì™¸ê°) ì—¬ë¶€ ë¶„ì„\")\n",
        "print(\"=\"*80)\n",
        "\n",
        "audit_col = 'ì™¸ê°êµ¬ë¶„'\n",
        "\n",
        "if audit_col in df.columns and target_col in df.columns:\n",
        "    # ì™¸ê° ì—¬ë¶€ë³„ ë¶€ë„ìœ¨\n",
        "    audit_stats = df.groupby(audit_col)[target_col].agg([\n",
        "        ('ê¸°ì—…ìˆ˜', 'count'),\n",
        "        ('ë¶€ë„ìˆ˜', 'sum'),\n",
        "        ('ë¶€ë„ìœ¨', 'mean')\n",
        "    ]).reset_index()\n",
        "    \n",
        "    audit_stats['ë¶€ë„ìœ¨(%)'] = audit_stats['ë¶€ë„ìœ¨'] * 100\n",
        "    \n",
        "    print(\"\\nğŸ“Š ì™¸ê° ì—¬ë¶€ë³„ ë¶€ë„ìœ¨\")\n",
        "    print(\"-\"*60)\n",
        "    print(audit_stats.to_string(index=False))\n",
        "    \n",
        "    # ì‹œê°í™”\n",
        "    import plotly.graph_objects as go\n",
        "    \n",
        "    fig = go.Figure()\n",
        "    fig.add_trace(go.Bar(\n",
        "        x=audit_stats[audit_col],\n",
        "        y=audit_stats['ë¶€ë„ìœ¨(%)'],\n",
        "        text=[f\"{rate:.2f}%\" for rate in audit_stats['ë¶€ë„ìœ¨(%)']],\n",
        "        textposition='outside',\n",
        "        marker_color=['lightgreen' if 'ì™¸ê°' in str(x) else 'lightcoral' \n",
        "                     for x in audit_stats[audit_col]],\n",
        "        hovertemplate='ì™¸ê°: %{x}<br>ë¶€ë„ìœ¨: %{y:.2f}%<br>ê¸°ì—…ìˆ˜: %{customdata[0]}<br>ë¶€ë„ìˆ˜: %{customdata[1]}<extra></extra>',\n",
        "        customdata=audit_stats[['ê¸°ì—…ìˆ˜', 'ë¶€ë„ìˆ˜']].values\n",
        "    ))\n",
        "    \n",
        "    fig.update_layout(\n",
        "        title='ì™¸ê° ì—¬ë¶€ë³„ ë¶€ë„ìœ¨',\n",
        "        xaxis_title='ì™¸ê° êµ¬ë¶„',\n",
        "        yaxis_title='ë¶€ë„ìœ¨ (%)',\n",
        "        height=500\n",
        "    )\n",
        "    fig.show()\n",
        "    \n",
        "    # ì°¨ì´ ë¶„ì„\n",
        "    if len(audit_stats) >= 2:\n",
        "        max_rate = audit_stats['ë¶€ë„ìœ¨(%)'].max()\n",
        "        min_rate = audit_stats['ë¶€ë„ìœ¨(%)'].min()\n",
        "        print(f\"\\nğŸ’¡ ì™¸ê° ì—¬ë¶€ì— ë”°ë¥¸ ë¶€ë„ìœ¨ ì°¨ì´: {max_rate - min_rate:.2f}%p\")\n",
        "        print(f\"   ì°¨ì´ ë°°ìˆ˜: {max_rate / max(min_rate, 0.01):.1f}ë°°\")\n",
        "else:\n",
        "    print(\"âš ï¸ ì™¸ê° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\")\n",
        "\n"
    ]))

    # í†µê³„ ê²€ì •
    new_cells.append(create_markdown_cell([
        "### ğŸ“ˆ í†µê³„ì  ê²€ì •\n",
        "\n"
    ]))

    new_cells.append(create_code_cell([
        "# ì™¸ê° ì—¬ë¶€ì™€ ë¶€ë„ì˜ ì—°ê´€ì„± ê²€ì •\n",
        "from scipy.stats import chi2_contingency\n",
        "\n",
        "print(\"ğŸ“Š ì™¸ê° ì—¬ë¶€ Chi-square ê²€ì •\")\n",
        "print(\"=\"*80)\n",
        "\n",
        "if audit_col in df.columns and target_col in df.columns:\n",
        "    # êµì°¨í‘œ\n",
        "    contingency = pd.crosstab(df[audit_col], df[target_col])\n",
        "    \n",
        "    # Chi-square test\n",
        "    chi2, p_value, dof, expected = chi2_contingency(contingency)\n",
        "    \n",
        "    print(f\"\\nê·€ë¬´ê°€ì„¤ (H0): ì™¸ê° ì—¬ë¶€ì™€ ë¶€ë„ëŠ” ë…ë¦½ì ì´ë‹¤\")\n",
        "    print(f\"ëŒ€ë¦½ê°€ì„¤ (H1): ì™¸ê° ì—¬ë¶€ì™€ ë¶€ë„ëŠ” ì—°ê´€ì„±ì´ ìˆë‹¤\")\n",
        "    print(f\"\\nê²°ê³¼:\")\n",
        "    print(f\"  â€¢ Chi-square: {chi2:.2f}\")\n",
        "    print(f\"  â€¢ p-value: {p_value:.2e}\")\n",
        "    \n",
        "    if p_value < 0.001:\n",
        "        print(f\"\\nâœ… ì™¸ê° ì—¬ë¶€ëŠ” ë¶€ë„ì™€ ë§¤ìš° ìœ ì˜í•œ ì—°ê´€ì„± (p < 0.001)\")\n",
        "    elif p_value < 0.05:\n",
        "        print(f\"\\nâœ… ì™¸ê° ì—¬ë¶€ëŠ” ë¶€ë„ì™€ ìœ ì˜í•œ ì—°ê´€ì„± (p < 0.05)\")\n",
        "    else:\n",
        "        print(f\"\\nâŒ ì™¸ê° ì—¬ë¶€ëŠ” ë¶€ë„ì™€ ë…ë¦½ì  (p â‰¥ 0.05)\")\n",
        "else:\n",
        "    print(\"âš ï¸ ì™¸ê° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\")\n",
        "\n"
    ]))

    # 3-layer í•´ì„
    new_cells.append(create_markdown_cell([
        "### ğŸ“Š í†µê³„ì  ì‚¬ì‹¤\n",
        "\n",
        "- ì™¸ê° ê¸°ì—…ê³¼ ë¹„ì™¸ê° ê¸°ì—…ì˜ ë¶€ë„ìœ¨ ì°¨ì´\n",
        "- Chi-square testì—ì„œ ìœ ì˜í•œ ì—°ê´€ì„±\n",
        "\n",
        "### ğŸ’¡ ì¬ë¬´ í•´ì„\n",
        "\n",
        "1. **ì™¸ë¶€ê°ì‚¬ì˜ ì˜ë¯¸**\n",
        "   - ì™¸ê° ê¸°ì—…: ìì‚° 120ì–µ ì´ìƒ, ìƒì¥ì‚¬ ë“±\n",
        "   - íšŒê³„ íˆ¬ëª…ì„±, ì¬ë¬´ ì‹ ë¢°ë„ê°€ ë†’ìŒ\n",
        "   - ëŒ€ì¶œ, íˆ¬ì ìœ ì¹˜ì— ìœ ë¦¬\n",
        "\n",
        "2. **í•œêµ­ ì‹œì¥ íŠ¹ì„±**\n",
        "   - ì™¸ê° ì˜ë¬´: ê·œëª¨ ìˆëŠ” ê¸°ì—…ì˜ ì§€í‘œ\n",
        "   - ë¹„ì™¸ê° ê¸°ì—…: ì˜ì„¸ ì¤‘ì†Œê¸°ì—…, ì •ë³´ ë¶ˆíˆ¬ëª…\n",
        "\n",
        "3. **ì‹ ë¢°ë„ í”„ë¦¬ë¯¸ì—„**\n",
        "   - ì™¸ê° = ì œ3ì ê²€ì¦\n",
        "   - ì¬ë¬´ì œí‘œ ì¡°ì‘ ê°€ëŠ¥ì„± ë‚®ìŒ\n",
        "\n",
        "### â¡ï¸ ë‹¤ìŒ ì•¡ì…˜\n",
        "\n",
        "1. **ì™¸ê° ì—¬ë¶€ë¥¼ ì´ì§„ ë³€ìˆ˜ë¡œ í¬í•¨**\n",
        "   - 0: ë¹„ì™¸ê°, 1: ì™¸ê°\n",
        "\n",
        "2. **ë³µí•© ì‹ ë¢°ë„ ì§€í‘œ**\n",
        "   - ì™¸ê° + ìƒì¥ ì—¬ë¶€ + ê¸°ì—… ê·œëª¨ â†’ ì¢…í•© ì‹ ë¢°ë„ ìŠ¤ì½”ì–´\n",
        "\n",
        "3. **ë¹„ì™¸ê° ê¸°ì—… íŠ¹ë³„ ê´€ë¦¬**\n",
        "   - ë¹„ì™¸ê° ê¸°ì—…ì— ëŒ€í•œ ë³„ë„ ëª¨ë¸ ë˜ëŠ” ê°€ì¤‘ì¹˜ ì¡°ì •\n",
        "\n"
    ]))

    # ====================================================================
    # SECTION: Key Takeaways â†’ Next Steps
    # ====================================================================
    print("âœï¸  Key Takeaways ì„¹ì…˜ ì‘ì„±...")

    new_cells.append(create_markdown_cell([
        "---\n",
        "\n",
        "## ğŸ“Œ Key Takeaways â†’ Next Steps\n",
        "\n",
        "### âœ… í•µì‹¬ ë°œê²¬ (Part 1ì—ì„œ í™•ì¸í•œ ê²ƒ)\n",
        "\n",
        "1. **ê·¹ë„ë¡œ ë¶ˆê· í˜•í•œ ë°ì´í„° (1:66)**\n",
        "   - í‰ê°€ ì§€í‘œ: PR-AUC, F2-Score ì‚¬ìš© í•„ìˆ˜\n",
        "   - ìƒ˜í”Œë§: SMOTE + Tomek Links í•„ìš”\n",
        "\n",
        "2. **ìœ ë™ì„±ì´ ê°€ì¥ ê°•ë ¥í•œ ë‹¨ë³€ëŸ‰ ì˜ˆì¸¡ ë³€ìˆ˜**\n",
        "   - ìœ ë™ë¹„ìœ¨, ë‹¹ì¢Œë¹„ìœ¨, í˜„ê¸ˆë¹„ìœ¨ ëª¨ë‘ ìœ ì˜í•œ ì°¨ì´ (p < 0.001)\n",
        "   - Cliff's delta: ì¤‘ê°„~í° íš¨ê³¼ í¬ê¸°\n",
        "   - \"Cash is King\" - í˜„ê¸ˆì´ ì—†ìœ¼ë©´ í‘ìë„ ë¶€ë„\n",
        "\n",
        "3. **ì—…ì¢…ë³„ ë¶€ë„ìœ¨ 2~3ë°° ì°¨ì´**\n",
        "   - Chi-square test: ì—…ì¢…ê³¼ ë¶€ë„ëŠ” ìœ ì˜í•œ ì—°ê´€ì„± (p < 0.001)\n",
        "   - ì œì¡°ì—… > ê±´ì„¤ì—… > ì„œë¹„ìŠ¤ì—… ìˆœ\n",
        "\n",
        "4. **ì™¸ê° ì—¬ë¶€ê°€ ì¤‘ìš”í•œ ì‹ ë¢°ë„ ì§€í‘œ**\n",
        "   - ì™¸ê° ê¸°ì—… vs ë¹„ì™¸ê° ê¸°ì—… ë¶€ë„ìœ¨ ì°¨ì´\n",
        "   - í•œêµ­ ì‹œì¥ íŠ¹ìˆ˜ì„± ë°˜ì˜\n",
        "\n",
        "### âš ï¸ í•œê³„ (Part 1ì˜ í•œê³„ì )\n",
        "\n",
        "1. **ê°œë³„ ë³€ìˆ˜ë¡œëŠ” ì˜ˆì¸¡ë ¥ ì œí•œì **\n",
        "   - ë‹¨ë³€ëŸ‰ AUC < 0.7 (ì°¸ê³ : ì‹¤ë¬´ì—ì„œëŠ” 0.8+ í•„ìš”)\n",
        "   - ìœ ë™ë¹„ìœ¨ë§Œìœ¼ë¡œëŠ” ë¶€ë„ë¥¼ ì •í™•íˆ ì˜ˆì¸¡ ë¶ˆê°€\n",
        "\n",
        "2. **ë³€ìˆ˜ ê°„ ìƒí˜¸ì‘ìš© ë¯¸ê³ ë ¤**\n",
        "   - ìœ ë™ì„± + ìˆ˜ìµì„±ì˜ ì¡°í•©ì€?\n",
        "   - ë¶€ì±„ë¹„ìœ¨ì´ ë†’ì•„ë„ ì´ìë³´ìƒë°°ìœ¨ì´ ë†’ìœ¼ë©´?\n",
        "\n",
        "3. **ë¹„ì„ í˜• ê´€ê³„ ë¯¸íƒìƒ‰**\n",
        "   - ë¶€ì±„ë¹„ìœ¨ 50% vs 200%ì˜ ë¦¬ìŠ¤í¬ ì°¨ì´ëŠ” ì„ í˜•ì´ ì•„ë‹˜\n",
        "   - ì„ê³„ì (threshold) ì¡´ì¬ ê°€ëŠ¥\n",
        "\n",
        "### â¡ï¸ ë‹¤ìŒ ë‹¨ê³„: **Part 2 - ë„ë©”ì¸ ì§€ì‹ ê¸°ë°˜ ë³µí•© íŠ¹ì„± ìƒì„±**\n",
        "\n",
        "#### 1. ìœ ë™ì„± ìœ„ê¸° ì§€í‘œ (10ê°œ íŠ¹ì„±)\n",
        "- **ì¦‰ê°ì§€ê¸‰ëŠ¥ë ¥** = í˜„ê¸ˆ / ë‹¨ê¸°ì°¨ì…ê¸ˆ\n",
        "- **í˜„ê¸ˆì†Œì§„ì¼ìˆ˜** = í˜„ê¸ˆ / (ì˜ì—…ë¹„ìš© / 365)\n",
        "- **ìš´ì „ìë³¸ ê±´ì „ì„±** = (ìœ ë™ìì‚° - ìœ ë™ë¶€ì±„) / ì´ìì‚°\n",
        "- **ê¸´ê¸‰ìœ ë™ì„±** = (í˜„ê¸ˆ + ë‹¨ê¸°ê¸ˆìœµìì‚°) / ìœ ë™ë¶€ì±„\n",
        "\n",
        "#### 2. ì§€ê¸‰ë¶ˆëŠ¥ íŒ¨í„´ (8ê°œ íŠ¹ì„±)\n",
        "- **ìë³¸ì ì‹ë„** = ìë³¸ / ì´ìì‚° (ìŒìˆ˜ë©´ ì™„ì „ ì ì‹)\n",
        "- **ì´ìë³´ìƒë°°ìœ¨** = ì˜ì—…ì´ìµ / ì´ìë¹„ìš©\n",
        "- **ë¶€ì±„ìƒí™˜ë…„ìˆ˜** = ë¶€ì±„ / ì˜ì—…í˜„ê¸ˆíë¦„\n",
        "- **ì¬ë¬´ë ˆë²„ë¦¬ì§€** = ì´ìì‚° / ìë³¸\n",
        "\n",
        "#### 3. ì¬ë¬´ì¡°ì‘ íƒì§€ (15ê°œ íŠ¹ì„±)\n",
        "- **í•œêµ­í˜• M-Score** (Beneish M-Score ë³€í˜•)\n",
        "- **ë§¤ì¶œì±„ê¶Œ ì´ìƒì§€í‘œ** = (ë§¤ì¶œì±„ê¶Œ / ë§¤ì¶œ) ì¦ê°€ìœ¨\n",
        "- **ì¬ê³  ì´ìƒì§€í‘œ** = (ì¬ê³  / ë§¤ì¶œì›ê°€) ì¦ê°€ìœ¨\n",
        "- **ë°œìƒì•¡ í’ˆì§ˆ** = (ë‹¹ê¸°ìˆœì´ìµ - ì˜ì—…í˜„ê¸ˆíë¦„) / ì´ìì‚°\n",
        "\n",
        "#### 4. í•œêµ­ ì‹œì¥ íŠ¹í™” (13ê°œ íŠ¹ì„±)\n",
        "- **ëŒ€ê¸°ì—… ì˜ì¡´ë„** = ìƒìœ„ 3ê°œ ê±°ë˜ì²˜ ë§¤ì¶œ / ì´ë§¤ì¶œ\n",
        "- **ì œì¡°ì—… ë¦¬ìŠ¤í¬** = ì—…ì¢… ë”ë¯¸ Ã— ì¬ê³ /ìœ ë™ìì‚° ë¹„ìœ¨\n",
        "- **ì™¸ê° ì—¬ë¶€** (0/1)\n",
        "- **ì—…ë ¥** = 2021 - ì„¤ë¦½ì—°ë„\n",
        "\n",
        "#### 5. ì´í•´ê´€ê³„ì í–‰ë™ (9ê°œ íŠ¹ì„±)\n",
        "- **ì—°ì²´ ì •ë³´** (ê¸°ì—…ì‹ ìš©ê³µì—¬ì—°ì²´ ë“±)\n",
        "- **ì„¸ê¸ˆì²´ë‚©** (êµ­ì„¸, ì§€ë°©ì„¸)\n",
        "- **ì‹ ìš©ë“±ê¸‰** (êµ¬ê°„í™”)\n",
        "- **ì´í•´ê´€ê³„ì ë¶ˆì‹ ì§€ìˆ˜** = ì—°ì²´ + ì²´ë‚© + ì‹ ìš©ë“±ê¸‰\n",
        "\n",
        "#### 6. ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ (7ê°œ íŠ¹ì„±)\n",
        "- **ì¢…í•©ë¶€ë„ìœ„í—˜ìŠ¤ì½”ì–´** = ê°€ì¤‘í•© (ìœ ë™ì„± + ìˆ˜ìµì„± + ë¶€ì±„)\n",
        "- **ì¡°ê¸°ê²½ë³´ì‹ í˜¸ìˆ˜** = ì„ê³„ê°’ ì´ˆê³¼ ì§€í‘œ ê°œìˆ˜\n",
        "- **ì¬ë¬´ê±´ì „ì„±ì§€ìˆ˜** = PCA ë˜ëŠ” ìš”ì¸ë¶„ì„\n",
        "\n",
        "#### 7. ìƒí˜¸ì‘ìš©/ë¹„ì„ í˜• (3ê°œ íŠ¹ì„±)\n",
        "- **ë ˆë²„ë¦¬ì§€ Ã— ìˆ˜ìµì„±** = ë¶€ì±„ë¹„ìœ¨ Ã— ROA\n",
        "- **ë¶€ì±„ë¹„ìœ¨ ì œê³±** (ë¹„ì„ í˜• ë¦¬ìŠ¤í¬)\n",
        "- **ì„ê³„ê°’ ê¸°ë°˜ íŠ¹ì„±** (ì˜ˆ: ì´ìë³´ìƒë°°ìœ¨ < 1)\n",
        "\n",
        "### ğŸ¯ ìµœì¢… ëª©í‘œ\n",
        "\n",
        "- **65ê°œ ë„ë©”ì¸ íŠ¹ì„±** ìƒì„± (Part 2)\n",
        "- **ì•™ìƒë¸” ëª¨ë¸** í•™ìŠµ (LightGBM, XGBoost, CatBoost) (Part 4)\n",
        "- **PR-AUC 0.8+**, **F2-Score 0.7+**, **Type II Error < 20%** ë‹¬ì„± (Part 5)\n",
        "\n",
        "---\n",
        "\n",
        "## ğŸš€ Part 2ì—ì„œ ê³„ì†...\n",
        "\n",
        "ë‹¤ìŒ ë…¸íŠ¸ë¶: **ë°œí‘œ_Part2_ë„ë©”ì¸_íŠ¹ì„±_ê³µí•™.ipynb**\n",
        "\n"
    ]))

    # ====================================================================
    # ë…¸íŠ¸ë¶ ì €ì¥
    # ====================================================================
    print("ğŸ’¾ ë…¸íŠ¸ë¶ ì €ì¥ ì¤‘...")

    notebook = {
        "cells": new_cells,
        "metadata": {
            "kernelspec": {
                "display_name": "Python 3",
                "language": "python",
                "name": "python3"
            },
            "language_info": {
                "codemirror_mode": {
                    "name": "ipython",
                    "version": 3
                },
                "file_extension": ".py",
                "mimetype": "text/x-python",
                "name": "python",
                "nbconvert_exporter": "python",
                "pygments_lexer": "ipython3",
                "version": "3.8.0"
            }
        },
        "nbformat": 4,
        "nbformat_minor": 4
    }

    with open(output_path, 'w', encoding='utf-8') as f:
        json.dump(notebook, f, ensure_ascii=False, indent=2)

    print(f"âœ… ë…¸íŠ¸ë¶ ìƒì„± ì™„ë£Œ: {output_path}")
    print(f"   ì´ {len(new_cells)}ê°œ ì…€ ìƒì„±")

    # ì…€ ì¢…ë¥˜ë³„ ì¹´ìš´íŠ¸
    markdown_count = sum(1 for cell in new_cells if cell['cell_type'] == 'markdown')
    code_count = sum(1 for cell in new_cells if cell['cell_type'] == 'code')
    print(f"   - ë§ˆí¬ë‹¤ìš´ ì…€: {markdown_count}ê°œ")
    print(f"   - ì½”ë“œ ì…€: {code_count}ê°œ")

if __name__ == '__main__':
    main()
