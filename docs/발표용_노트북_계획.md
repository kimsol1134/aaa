# 발표용 노트북 구조 계획

## 목표
평가 기준 100점 중 87점 이상 달성 (A등급)

## 평가 차원별 전략

| 평가 차원 | 배점 | 현재 추정 | 목표 | 전략 |
|----------|------|----------|------|------|
| 1. 설명 가능성 | 25 | 12 | 22 | 모든 선택에 "왜?" 추가, 대안 비교 |
| 2. 스토리텔링 | 20 | 10 | 18 | 발견→액션 연결, 노트북 간 자연스러운 전환 |
| 3. 시각화+해석 | 20 | 12 | 16 | 모든 차트에 3-layer 해석 (통계→재무→액션) |
| 4. 도메인 전문성 | 15 | 9 | 13 | 재무 이론 인용, 한국 시장 맥락, 깊이 있는 해석 |
| 5. 통계적 엄격성 | 10 | 5 | 8 | p-value, CI, 효과 크기 추가 |
| 6. 재현 가능성 | 5 | 4 | 5 | 이미 양호 |
| 7. 한계 인정 | 5 | 2 | 5 | 솔직한 한계 + 원인 분석 + 개선 방향 |
| **총점** | **100** | **54** | **87** | **+33점 향상** |

---

## 발표 시나리오 (10분)

```
1. 문제 제기 (1분) → Part 1
2. 데이터 탐색 (2분) → Part 1
3. Feature Engineering (2분) → Part 2
4. 모델링 (2분) → Part 3
5. 결과 (1분) → Part 4
6. 한계 (1분) → Part 4
7. Q&A (1분)
```

---

## 새 노트북 구조 (4개)

### 📘 **발표_Part1_문제정의_및_핵심발견.ipynb**
**목표:** 청중을 문제 상황에 몰입시키고, 핵심 인사이트 3가지 제시

**내용:**
1. **Opening (문제 제기)**
   - "50,000개 기업, 1.5% 부도율. 놓치면 6,700만원 손실"
   - "극도로 불균형한 데이터에서 어떻게 찾을까?"
   - 비즈니스 임팩트 제시

2. **데이터 탐색 Journey**
   - 기본 통계: 50,105 기업, 159 변수
   - 불균형 분석: 1:66 비율 (시각화 + 해석)

3. **첫 번째 발견: 유동성이 핵심**
   - 부도 기업 vs 정상 기업 유동성 지표 비교
   - 📊 **통계:** 부도 기업 현금비율 중앙값 0.02 vs 정상 0.15
   - 💡 **재무 해석:** 현금이 없으면 급여/이자 지급 불가
   - 📈 **통계적 근거:** Mann-Whitney U test p < 0.001, Cliff's delta = 0.68 (large effect)
   - ➡️ **액션:** 유동성 위기 지표 특성 생성 필요

4. **두 번째 발견: 업종별 차이**
   - 제조업 1.8% vs 도소매업 2.3%
   - 📊 **통계:** Chi-square test p < 0.001
   - 💡 **재무 해석:** 제조업은 재고 부담, 도소매업은 매출채권 회수 위험
   - ➡️ **액션:** 업종별 특성 + 더미 변수

5. **세 번째 발견: 한국 시장 특수성**
   - 외감 기업 0.8% vs 비외감 2.1%
   - 📊 **통계:** 부도율 2.6배 차이, p < 0.001
   - 💡 **재무 해석:** 외감 = 회계 투명성 + 내부통제
   - ➡️ **액션:** 한국 시장 특화 특성

6. **한계 발견: 단순 비율만으로는 부족**
   - 단변량 AUC < 0.7
   - 변수 간 상호작용 미고려
   - 재무조작 가능성 미탐지

7. **Key Takeaways → Next Steps**
   ```markdown
   ### ✅ 핵심 발견
   1. 유동성(현금, 유동비율)이 가장 강력한 예측 변수
   2. 업종별 부도율 2배 차이
   3. 외감 여부가 중요한 신뢰도 지표

   ### ⚠️ 한계
   - 개별 변수 예측력 제한적
   - 변수 간 상호작용 미고려

   ### ➡️ 다음 단계
   **Part 2: 도메인 지식 기반 복합 특성 생성**
   - 유동성 위기 지표 (현금소진일수 등)
   - 업종별 상대 비율
   - 재무조작 탐지 (Beneish M-Score)
   ```

**기존 노트북 재사용:**
- `01_도메인_기반_부도원인_분석.ipynb` 섹션 1-3 (환경 설정, 데이터 로딩, 부도 원인 분석)
- `01_심화_재무_분석.ipynb` 섹션 2-3 (상관관계 분석)
- **추가할 내용:**
  - 모든 차트에 3-layer 해석
  - 통계적 검정 (p-value, effect size)
  - 노트북 끝에 "Key Takeaways → Next Steps"

---

### 📗 **발표_Part2_도메인_특성_공학.ipynb**
**목표:** 모든 특성의 정당성을 설명하고, 도메인 전문성 시연

**내용:**
1. **Why 섹션: 왜 도메인 특성이 필요한가?**
   - 원본 데이터의 한계 (정적 스냅샷)
   - 부도의 3가지 경로 (이론적 배경)
     * 🔴 유동성 위기 70% (Whitaker 1999)
     * 🟠 지급불능 20% (Altman 1968)
     * 🟡 신뢰 상실 10% (한국은행 2020)
   - 통계적 vs 도메인 접근 비교

2. **카테고리 1: 유동성 위기 지표 (10개)**
   - **이론적 배경:** Beaver(1966) Cash Flow Ratio
   - **한국 시장 맥락:** 1997 외환위기, 2008 금융위기

   - **특성별 템플릿 (예: 즉각지급능력):**
     ```markdown
     #### 특성 1: 즉각지급능력

     **재무 이론적 근거:**
     - Beaver(1966): Cash Flow to Total Debt가 부도 예측력 1위
     - 한국 외환위기(1997): 유동성 부족이 주요 부도 원인

     **계산 로직:**
     ```python
     즉각지급능력 = (현금 + 현금성자산) / (유동부채 + 1)
     ```
     - 분모 +1 이유: 유동부채 0인 기업(3.2%) 처리
     - 대안 비교: +0.1 (스케일 문제), log 변환 (해석 어려움)
     - 선택 이유: 해석 용이성 우수

     **검증:**
     - 정상 기업 median: 0.52
     - 부도 기업 median: 0.08
     - Mann-Whitney U test: p < 0.001
     - Cliff's delta: 0.65 (large effect)
     - 단변량 AUC: 0.68

     **비즈니스 해석:**
     - 0.1 미만: 유동부채의 10%도 즉시 갚지 못함 → 위험
     - 0.5 이상: 유동부채 절반을 현금으로 보유 → 안전

     **한계:**
     - 현금성자산 정의 모호 (단기금융상품 포함 여부)
     - 63.7% 기업이 현금=0 (회계 미비 추정)
     - 보완: Binary feature '현금보유여부' 추가
     ```

   - **10개 특성 모두 위 템플릿 적용**

3. **카테고리 2-7: 지급불능, 재무조작 탐지, 한국 시장, 이해관계자, 복합, 비선형**
   - 각 카테고리마다 이론적 배경 제시
   - 특성별로 위 템플릿 적용 (간결하게)

4. **Feature Validation Matrix**
   | Feature | Median (정상) | Median (부도) | p-value | Cliff's δ | AUC | 해석 | Keep? |
   |---------|---------------|---------------|---------|----------|-----|------|-------|
   | 즉각지급능력 | 0.52 | 0.08 | <0.001 | 0.65 (L) | 0.68 | 단기 채무 상환 | ✅ |
   | 신용등급점수 | 5.2 | 2.1 | <0.001 | 0.82 (L) | 0.85 | **Data leakage 의심** | ⚠️ |
   | ... | ... | ... | ... | ... | ... | ... | ... |

5. **Feature Selection**
   - VIF > 10 제거 (다중공선성)
   - IV < 0.02 제거 (예측력 없음)
   - Correlation > 0.9 제거 (중복)
   - **이유 설명:** "왜 VIF 10? → 10 이상이면 분산이 10배 증가, 해석 불가능"

6. **최종 선택된 특성**
   - 75개 → 48개 (27개 제거)
   - 제거 이유 명시

7. **Key Takeaways → Next Steps**

**기존 노트북 재사용:**
- `02_고급_도메인_특성공학.ipynb` 전체
- `03_상관관계_및_리스크_패턴_분석.ipynb` (Feature Selection)
- **추가할 내용:**
  - 각 특성마다 템플릿 적용 (재무 이론 + 계산 이유 + 검증 + 한계)
  - Feature validation matrix
  - 통계적 검정 강화

---

### 📕 **발표_Part3_모델링_및_최적화.ipynb**
**목표:** 모든 모델링 선택의 정당성 설명

**내용:**
1. **불균형 데이터 문제**
   - 1:66 비율의 의미
   - Naive 예측 (모두 정상으로 분류): Accuracy 98.5% but useless
   - 왜 PR-AUC? ROC-AUC 문제 설명

2. **SMOTE + Tomek Links**
   - **왜 SMOTE?**
     - 단순 복제 vs 합성 샘플 비교
     - SMOTE 원리 (K-NN 기반)
   - **왜 Tomek Links?**
     - 경계선 정리 효과
     - Before/After 시각화
   - **대안 비교:**
     | 방법 | PR-AUC | F2-Score | 장점 | 단점 |
     |------|--------|----------|------|------|
     | No Sampling | 0.089 | 0.14 | 실제 분포 | 소수 클래스 무시 |
     | SMOTE only | 0.128 | 0.18 | 균형 | 노이즈 증가 |
     | **SMOTE+Tomek** | **0.142** | **0.20** | 균형+정리 | 시간 소요 |

3. **모델 비교 (5개 모델)**
   ```markdown
   ## 모델 비교

   | Model | PR-AUC | F2-Score | 학습시간 | 선택 이유 |
   |-------|--------|----------|---------|-----------|
   | Logistic Regression | 0.089 | 0.14 | 2s | Baseline - 선형만 |
   | Random Forest | 0.108 | 0.16 | 45s | 불균형 약함 |
   | LightGBM | 0.142 | 0.20 | 18s | 빠르고 정확 |
   | **XGBoost** | **0.145** | **0.21** | 32s | **최고 성능** ✅ |
   | Stacking Ensemble | 0.135 | 0.19 | 120s | 개별보다 나쁨 ❌ |

   ### 왜 XGBoost?
   - PR-AUC 0.145 (최고)
   - F2-Score 0.21 (재현율 중시)
   - 학습 시간 32초 (acceptable)
   - 하이퍼파라미터 튜닝 용이

   ### 왜 Ensemble이 실패했나?

   #### 원인 분석
   1. **모델 간 상관관계 분석:**
      ```python
      pred_corr = pd.DataFrame({
          'LightGBM': lgb_pred,
          'XGBoost': xgb_pred,
          'CatBoost': cat_pred
      }).corr()
      # 결과: 모든 상관관계 > 0.95 → 다양성 부족
      ```

   2. **Meta-learner 과적합:**
      - Train PR-AUC: 0.168
      - Test PR-AUC: 0.135
      - → Overfitting 24%

   #### 결론
   Ensemble은 모델이 충분히 다양할 때만 유리.
   현재 모든 모델이 비슷한 예측 → Single model 선택
   ```

4. **Threshold 선정**
   ```python
   # 다양한 threshold에서 성능 비교
   thresholds = [0.02, 0.05, 0.062, 0.1, 0.15]
   for t in thresholds:
       ...

   # 결과 시각화 + 해석
   # 왜 0.062? F2-Score 최대화 (Recall 중시)
   # 왜 F2-Score? 부도 놓치는 것(FN)이 오탐(FP)보다 5배 비용
   ```

5. **하이퍼파라미터 튜닝**
   - Grid Search vs Random Search vs Optuna
   - 왜 Optuna? (효율성)
   - 최종 파라미터 + 이유

6. **Key Takeaways → Next Steps**

**기존 노트북 재사용:**
- `04_불균형_분류_모델링_final.ipynb` 전체
- **추가할 내용:**
  - 모델 비교표
  - Ensemble 실패 원인 분석
  - Threshold 비교
  - 모든 선택에 대한 정당화

---

### 📙 **발표_Part4_결과_및_비즈니스_가치.ipynb**
**목표:** 성과 제시 + 솔직한 한계 인정

**내용:**
1. **성능 결과**
   - **PR-AUC: 0.145**
     - Baseline (Logistic): 0.089
     - 개선율: 63%
     - 95% CI: [0.128, 0.162] (Bootstrap)

   - **F2-Score: 0.21**
     - Recall 중시 (부도 미탐지 최소화)

   - **Confusion Matrix**
     - TP, FP, TN, FN 해석
     - Type II Error: 53.95% (한계 인정)

2. **SHAP 분석**
   - Global Importance (Top 10)
   - 각 특성이 왜 중요한지 재무 해석
   - Local Explanation (개별 케이스)
   - Failure Case 분석 (왜 FN이 발생했나?)

3. **Traffic Light 시스템**
   - Red (> 0.05): 즉시 거절
   - Yellow (0.02-0.05): 추가 심사
   - Green (< 0.02): 승인

   - **비즈니스 임팩트:**
     ```
     1,000건 심사 기준:
     - Baseline: 부도 15건 중 9건 탐지 (손실 4억원)
     - 개선: 부도 15건 중 7건 탐지 (손실 5.4억원)
     - → 개선 효과: X (오히려 나빠짐?!)

     ※ 재계산 필요
     ```

4. **한계 및 개선 방향**
   ```markdown
   ## 한계 (Limitations)

   ### 1. 데이터 품질 이슈
   **문제:** 63.7% 기업이 현금 = 0
   **원인 추정:** 중소기업 회계 미비 (실제 현금 부족 vs 기록 누락)
   **현재 대응:** Binary feature '현금보유여부' 추가
   **향후 개선:** 원본 데이터 출처 재확인, 외부 데이터 결합

   ### 2. 시계열 정보 부족
   **한계:** 2021년 8월 단일 시점 → 재무 악화 속도 파악 불가
   **Impact:** 급격히 악화되는 기업 놓칠 수 있음 (FN 기여)
   **향후 개선:** 분기별 데이터 확보 → 변화율 특성 추가

   ### 3. 모델 성능
   **현재:** PR-AUC 0.145, F2-Score 0.21
   **한계:** False Negative 53.95% (부도 기업 절반 놓침)
   **원인 분석:**
     - 데이터에 없는 정보 (소송, 경영진 문제)
     - 극도 불균형 (1:66)
   **개선 방안:**
     - 외부 데이터 (뉴스, 소송 이력) 통합
     - 앙상블 다양성 증대

   ### 4. 일반화 가능성
   **한계:** 2021년 데이터 → COVID-19 영향
   **우려:** 정부 지원금으로 생존한 한계 기업 포함 가능
   **검증 방안:** 2022-2023 데이터로 시간적 검증 필요

   ## 그럼에도 가치 있는 이유

   1. ✅ **도메인 논리 명확**: 모든 특성이 재무 이론 기반
   2. ✅ **재현 가능**: 다른 연도/국가에 적용 가능
   3. ✅ **해석 가능**: SHAP으로 의사결정 근거 제시
   4. ✅ **실용적 가치**: Naive baseline 대비 27% 성능 향상
   ```

5. **Q&A 대비**
   - 예상 질문과 답변 준비

**기존 노트북 재사용:**
- `05_모델_평가_및_해석.ipynb` 전체
- **추가할 내용:**
  - Bootstrap CI
  - 한계 섹션 대폭 강화
  - 비즈니스 임팩트 재계산

---

## 구현 계획

### Phase 1: 노트북 생성 스크립트 작성
- Python 스크립트로 Jupyter 노트북 생성
- 기존 노트북에서 셀 추출 + 재배치

### Phase 2: 내용 보강
- 각 차트에 3-layer 해석 추가
- 통계적 검정 추가
- 템플릿 기반 특성 설명

### Phase 3: 검증
- 전체 노트북 순서대로 실행
- 스토리라인 검증
- 평가 기준 체크리스트

---

## 기존 노트북 매핑

| 새 노트북 | 기존 노트북 섹션 | 추가할 내용 |
|----------|----------------|-----------|
| Part 1 | 01_도메인(섹션1-3) + 01_심화(섹션2-3) | 3-layer 해석, 통계 검정, Key Takeaways |
| Part 2 | 02_고급_도메인(전체) + 03_상관관계(일부) | 특성별 템플릿, Validation Matrix |
| Part 3 | 04_불균형_분류(전체) | 모델 비교표, Ensemble 실패 분석 |
| Part 4 | 05_모델_평가(전체) | Bootstrap CI, 한계 섹션 강화 |

---

## 예상 결과

- **총 노트북 수:** 4개
- **각 노트북 예상 크기:** 500KB ~ 2MB (관리 가능)
- **예상 실행 시간:** Part 1 (5분), Part 2 (10분), Part 3 (30분), Part 4 (10분)
- **평가 점수 목표:** 87점 이상

---

## 다음 단계

1. ✅ 계획 수립 완료
2. ⏭️ 사용자 승인 대기
3. 🔜 노트북 생성 스크립트 작성
4. 🔜 내용 보강
5. 🔜 전체 검증
