## 7. ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ ìƒì„±

### ğŸ’¡ ì¬ë¬´ ì „ë¬¸ê°€ ê´€ì : ë‹¨ì¼ ì§€í‘œì˜ í•¨ì •

**í•™ìˆ ì  ë°°ê²½ (Ohlson 1980)**

James Ohlsonì€ **ë‹¨ì¼ ì¬ë¬´ ë¹„ìœ¨ë¡œëŠ” ë¶€ë„ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ì—†ë‹¤**ëŠ” ê²ƒì„ ì‹¤ì¦í–ˆìŠµë‹ˆë‹¤. ëŒ€ì‹  **ì—¬ëŸ¬ ë„ë©”ì¸ì˜ íŠ¹ì„±ì„ ê²°í•©í•œ ë³µí•© ì§€í‘œ**ê°€ í•„ìš”í•©ë‹ˆë‹¤.

**ë³µí•© ì§€í‘œì˜ ì„¤ê³„ ì›ë¦¬:**

1. **ì¬ë¬´ê±´ì „ì„±ì§€ìˆ˜** = ìœ ë™ì„± + ìˆ˜ìµì„± + ì§€ê¸‰ëŠ¥ë ¥ì˜ í‰ê· 
2. **ìœ ë™ì„±ìŠ¤íŠ¸ë ˆìŠ¤ì§€ìˆ˜** = ìš´ì „ìë³¸ ë¶€ì¡± + ë‹¨ê¸° ë¶€ì±„ ê³¼ë‹¤
3. **ì¢…í•©ë¶€ë„ìœ„í—˜ìŠ¤ì½”ì–´** = ê°€ì¤‘ í‰ê·  (ë„ë©”ì¸ë³„ ì°¨ë“± ê°€ì¤‘ì¹˜)
4. **ì¡°ê¸°ê²½ë³´ì‹ í˜¸ìˆ˜** = ìœ„í—˜ ì‹ í˜¸ ê°œìˆ˜ (ìë³¸ì ì‹ + ì—°ì²´ + í˜„ê¸ˆ ê³ ê°ˆ)

### ìƒì„±í•  7ê°œ ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ

| ì§€í‘œ | êµ¬ì„± ìš”ì†Œ | í™œìš© |
|------|-----------|------|
| ì¬ë¬´ê±´ì „ì„±ì§€ìˆ˜ | ìœ ë™ì„± + ìˆ˜ìµì„± + ì§€ê¸‰ëŠ¥ë ¥ | ì¢…í•© í‰ê°€ |
| ìœ ë™ì„±ìŠ¤íŠ¸ë ˆìŠ¤ì§€ìˆ˜ | ìš´ì „ìë³¸ + ë‹¨ê¸°ë¶€ì±„ë¹„ì¤‘ | ë‹¨ê¸° ìœ„í—˜ |
| ì§€ê¸‰ë¶ˆëŠ¥ìœ„í—˜ì§€ìˆ˜ | ìë³¸ì ì‹ + ë¶€ì±„ìƒí™˜ë…„ìˆ˜ | ì¥ê¸° ìœ„í—˜ |
| ì‹œì¥í¬ì§€ì…˜ì§€ìˆ˜ | ê·œëª¨ ì •ê·œí™” | ìƒëŒ€ ë¹„êµ |
| ì¢…í•©ë¶€ë„ìœ„í—˜ìŠ¤ì½”ì–´ | ì „ì²´ ê°€ì¤‘ í‰ê·  | ìµœì¢… ìŠ¤ì½”ì–´ |
| ì¡°ê¸°ê²½ë³´ì‹ í˜¸ìˆ˜ | ìœ„í—˜ ì‹ í˜¸ ê°œìˆ˜ | ê²½ë³´ ì‹œìŠ¤í…œ |
| ìœ„í—˜ê²½ë³´ë“±ê¸‰ | 4ë‹¨ê³„ ë¶„ë¥˜ | ë“±ê¸‰í™” |

**í•µì‹¬ ë©”ì‹œì§€:**
> "ë‚˜ë¬´ë¥¼ ë³´ì§€ ë§ê³  ìˆ²ì„ ë³´ë¼" - ì¢…í•© íŒë‹¨ì˜ ì¤‘ìš”ì„±

### ì½”ë“œ ì…€ #9

```python
def create_composite_risk_features(df, features_dict):
    """ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ ìƒì„± (ì—¬ëŸ¬ ë„ë©”ì¸ íŠ¹ì„±ì˜ ì¡°í•©)"""
    
    features = pd.DataFrame(index=df.index)
    
    # 1. ì¬ë¬´ê±´ì „ì„±ì§€ìˆ˜ (Financial Health Index)
    # ìœ ë™ì„± + ìˆ˜ìµì„± + ì§€ê¸‰ëŠ¥ë ¥ì˜ í‰ê· 
    liquidity_cols = ['ì¦‰ê°ì§€ê¸‰ëŠ¥ë ¥', 'í˜„ê¸ˆì†Œì§„ì¼ìˆ˜', 'ìš´ì „ìë³¸ë¹„ìœ¨']
    profitability_cols = ['ì˜ì—…ì´ìµë¥ ', 'ìˆœì´ìµë¥ ']
    solvency_cols = ['ì´ìë³´ìƒë°°ìœ¨', 'ë¶€ì±„ìƒí™˜ë…„ìˆ˜']
    
    # ê° ë„ë©”ì¸ë³„ ì •ê·œí™”ëœ ì ìˆ˜ ê³„ì‚°
    from sklearn.preprocessing import StandardScaler
    scaler = StandardScaler()
    
    liquidity_score = features_dict['liquidity'][liquidity_cols].fillna(0)
    liquidity_score = pd.DataFrame(
        scaler.fit_transform(liquidity_score), 
        index=liquidity_score.index, 
        columns=liquidity_score.columns
    ).mean(axis=1)
    
    profitability_score = features_dict['stakeholder'][profitability_cols].fillna(0)
    profitability_score = pd.DataFrame(
        scaler.fit_transform(profitability_score), 
        index=profitability_score.index, 
        columns=profitability_score.columns
    ).mean(axis=1)
    
    solvency_score = features_dict['insolvency'][solvency_cols].fillna(0)
    solvency_score = pd.DataFrame(
        scaler.fit_transform(solvency_score), 
        index=solvency_score.index, 
        columns=solvency_score.columns
    ).mean(axis=1)
    
    features['ì¬ë¬´ê±´ì „ì„±ì§€ìˆ˜'] = (liquidity_score + profitability_score + solvency_score) / 3
    
    # 2. ìœ ë™ì„±ìŠ¤íŠ¸ë ˆìŠ¤ì§€ìˆ˜
    features['ìœ ë™ì„±ìŠ¤íŠ¸ë ˆìŠ¤ì§€ìˆ˜'] = (
        -features_dict['liquidity']['ìš´ì „ìë³¸ë¹„ìœ¨'].fillna(0) + 
        features_dict['insolvency']['ë‹¨ê¸°ë¶€ì±„ë¹„ì¤‘'].fillna(0)
    ) / 2
    
    # 3. ì§€ê¸‰ë¶ˆëŠ¥ìœ„í—˜ì§€ìˆ˜
    features['ì§€ê¸‰ë¶ˆëŠ¥ìœ„í—˜ì§€ìˆ˜'] = (
        features_dict['insolvency']['ìë³¸ì ì‹ë„'].fillna(0) + 
        features_dict['insolvency']['ë¶€ì±„ìƒí™˜ë…„ìˆ˜'].fillna(0)
    ) / 2
    
    # 4. ì‹œì¥í¬ì§€ì…˜ì§€ìˆ˜ (ê·œëª¨ ì •ê·œí™”)
    if 'ì´ìì‚°' in df.columns:
        features['ì‹œì¥í¬ì§€ì…˜ì§€ìˆ˜'] = pd.qcut(
            df['ì´ìì‚°'].fillna(0), 
            q=10, 
            labels=False, 
            duplicates='drop'
        )
    else:
        features['ì‹œì¥í¬ì§€ì…˜ì§€ìˆ˜'] = 0
    
    # 5. ì¢…í•©ë¶€ë„ìœ„í—˜ìŠ¤ì½”ì–´ (ê°€ì¤‘ í‰ê· )
    weights = {
        'liquidity': 0.3,
        'insolvency': 0.3,
        'manipulation': 0.2,
        'stakeholder': 0.2
    }
    
    risk_components = []
    for domain, weight in weights.items():
        domain_features = features_dict[domain]
        # ê° ë„ë©”ì¸ì˜ í‰ê·  ë¦¬ìŠ¤í¬ ì ìˆ˜ ê³„ì‚°
        domain_score = domain_features.fillna(0).mean(axis=1)
        risk_components.append(domain_score * weight)
    
    features['ì¢…í•©ë¶€ë„ìœ„í—˜ìŠ¤ì½”ì–´'] = sum(risk_components)
    
    # 6. ì¡°ê¸°ê²½ë³´ì‹ í˜¸ìˆ˜ (ìœ„í—˜ ì‹ í˜¸ ê°œìˆ˜)
    warning_signals = []
    
    # ìë³¸ì ì‹
    if 'ìë³¸ì ì‹ë„' in features_dict['insolvency'].columns:
        warning_signals.append(
            (features_dict['insolvency']['ìë³¸ì ì‹ë„'] > 0.5).astype(int)
        )
    
    # ì—°ì²´ ì—¬ë¶€
    if 'ì—°ì²´ì—¬ë¶€' in features_dict['stakeholder'].columns:
        warning_signals.append(
            features_dict['stakeholder']['ì—°ì²´ì—¬ë¶€']
        )
    
    # í˜„ê¸ˆ ê³ ê°ˆ ìœ„í—˜
    if 'í˜„ê¸ˆì†Œì§„ì¼ìˆ˜' in features_dict['liquidity'].columns:
        warning_signals.append(
            (features_dict['liquidity']['í˜„ê¸ˆì†Œì§„ì¼ìˆ˜'] < 30).astype(int)
        )
    
    # ì´ìë³´ìƒë°°ìœ¨ < 1
    if 'ì´ìë³´ìƒë°°ìœ¨' in features_dict['insolvency'].columns:
        warning_signals.append(
            (features_dict['insolvency']['ì´ìë³´ìƒë°°ìœ¨'] < 1).astype(int)
        )
    
    features['ì¡°ê¸°ê²½ë³´ì‹ í˜¸ìˆ˜'] = sum(warning_signals) if warning_signals else 0
    
    # 7. ìœ„í—˜ê²½ë³´ë“±ê¸‰ (4ë‹¨ê³„ ë¶„ë¥˜)
    def classify_risk(score):
        if score < -1:
            return 0  # ì •ìƒ
        elif score < 0:
            return 1  # ì£¼ì˜
        elif score < 1:
            return 2  # ê²½ê³ 
        else:
            return 3  # ìœ„í—˜
    
    features['ìœ„í—˜ê²½ë³´ë“±ê¸‰'] = features['ì¢…í•©ë¶€ë„ìœ„í—˜ìŠ¤ì½”ì–´'].apply(classify_risk)
    
    return features

```

---

### ì½”ë“œ ì…€ #10

```python
# ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ ìƒì„± (ì•ì„œ ìƒì„±í•œ íŠ¹ì„±ë“¤ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ì „ë‹¬)
features_dict = {
    'liquidity': liquidity_features,
    'insolvency': insolvency_features,
    'manipulation': manipulation_features,
    'korean': korean_features,
    'stakeholder': profitability_activity_features  # ìˆ˜ìµì„± ì§€í‘œ í¬í•¨
}

composite_features = create_composite_risk_features(df, features_dict)
print(f"\nâœ… ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ {composite_features.shape[1]}ê°œ ìƒì„± ì™„ë£Œ")
print("\nìƒì„±ëœ ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ:")
print(composite_features.columns.tolist())

```

**ì¶œë ¥:**

```
ERROR: KeyError: "['ì˜ì—…ì´ìµë¥ '] not in index"
```

---

### ì½”ë“œ ì…€ #11

```python
# ëª¨ë“  íŠ¹ì„±ì„ í•˜ë‚˜ì˜ ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ í†µí•©
all_features = pd.concat([
    liquidity_features,
    insolvency_features,
    manipulation_features,
    korean_features,
    stakeholder_features,
    growth_features,
    profitability_activity_features,
    composite_features,
    interaction_features
], axis=1)

print(f"\nâœ… ì´ {all_features.shape[1]}ê°œì˜ ë„ë©”ì¸ ê¸°ë°˜ íŠ¹ì„± ìƒì„± ì™„ë£Œ")
print("\níŠ¹ì„± ì¹´í…Œê³ ë¦¬ë³„ ê°œìˆ˜:")
print(f"  - ìœ ë™ì„± ìœ„ê¸°: {liquidity_features.shape[1]}ê°œ")
print(f"  - ì§€ê¸‰ë¶ˆëŠ¥ íŒ¨í„´: {insolvency_features.shape[1]}ê°œ")
print(f"  - ì¬ë¬´ì¡°ì‘ íƒì§€: {manipulation_features.shape[1]}ê°œ")
print(f"  - í•œêµ­ ì‹œì¥ íŠ¹í™”: {korean_features.shape[1]}ê°œ")
print(f"  - ì´í•´ê´€ê³„ì í–‰ë™: {stakeholder_features.shape[1]}ê°œ")
print(f"  - ì„±ì¥ì„± ì§€í‘œ: {growth_features.shape[1]}ê°œ")
print(f"  - ìˆ˜ìµì„±/í™œë™ì„±: {profitability_activity_features.shape[1]}ê°œ")
print(f"  - ë³µí•© ë¦¬ìŠ¤í¬ ì§€í‘œ: {composite_features.shape[1]}ê°œ")
print(f"  - ìƒí˜¸ì‘ìš©/ë¹„ì„ í˜•: {interaction_features.shape[1]}ê°œ")

# ì›ë³¸ ë°ì´í„°ì˜ ê¸°ë³¸ ì •ë³´ì™€ íƒ€ê²Ÿ ë³€ìˆ˜ ì¶”ê°€
final_features = pd.concat([
    df[target_col],
    all_features
], axis=1)

# ê²°ì¸¡ì¹˜ ë¹„ìœ¨ í™•ì¸
missing_ratio = final_features.isnull().mean() * 100
print(f"\nê²°ì¸¡ì¹˜ 50% ì´ìƒì¸ íŠ¹ì„± ìˆ˜: {(missing_ratio > 50).sum()}ê°œ")
```

**ì¶œë ¥:**

```
ERROR: NameError: name 'growth_features' is not defined
```

---

