# 이해관계자_불신지수 데이터 누수 검증 보고서

## 📊 계산식 분석

### 최종 공식
```python
이해관계자_불신지수 = (
    연체여부 * 2 +                    # 0 또는 2
    세금체납리스크 +                   # 0 또는 5
    법적리스크 +                       # 0 또는 3
    신용등급점수 / 2                   # 0.5 ~ 5.0 (신용등급 1~10)
)
```

**값 범위:** 0.5 ~ 15.0
- 최소: 0.5 (연체 없음, 체납 없음, 법적 문제 없음, 신용등급 1등급)
- 최대: 15.0 (연체 있음, 체납 있음, 법적 문제 있음, 신용등급 10등급)

---

## 🔍 구성 요소 상세 분석

### 1. 연체여부 (가중치: 2)
**원천 데이터:**
```python
총연체건수 = sum(df['연체' 포함 컬럼])  # 예: 기업신용공여연체, 매출채권연체 등
연체여부 = (총연체건수 > 0) ? 1 : 0
```

**데이터 타이밍:**
- ✅ **부도 전에 측정 가능**
- 연체는 부도의 **조기 경보 신호** (일반적으로 30일~90일 전)
- 정상 기업도 일시적 연체 가능 → 누수 아님

**통계:**
- 정상기업 중앙값: 0
- 부도기업 중앙값: 0
- AUC: 0.689 (단변량 예측력 높음)

---

### 2. 세금체납리스크 (가중치: 5)
**원천 데이터:**
```python
세금체납건수 = sum(df['체납' 또는 '세금' 포함 컬럼])
세금체납리스크 = (세금체납건수 > 0) ? 5 : 0  # 있으면 5점, 없으면 0점
```

**데이터 타이밍:**
- ✅ **부도 전에 측정 가능**
- 세금체납은 부도의 **중기 신호** (3~6개월 전)
- 현금흐름 문제를 나타냄 → 누수 아님

**통계:**
- 정상기업 중앙값: 0
- 부도기업 중앙값: 0
- AUC: 0.559 (예측력 약함)

---

### 3. 법적리스크 (가중치: 3)
**원천 데이터:**
```python
공공정보리스크 = sum(df['압류', '소송', '공공' 포함 컬럼])
법적리스크 = (공공정보리스크 > 0) ? 3 : 0  # 있으면 3점, 없으면 0점
```

**데이터 타이밍:**
- ✅ **부도 전에 측정 가능**
- 압류/소송은 부도의 **장기 신호** (6~12개월 전)
- 법적 절차는 부도 전에 시작됨 → 누수 아님

**통계:**
- 공공정보리스크 AUC: 데이터 확인 필요

---

### 4. 신용등급점수 (가중치: 0.5)
**원천 데이터:**
```python
신용등급점수 = df['신용평가등급']  # 1~10 (1: AAA, 10: D)
```

**데이터 타이밍:**
- ⚠️ **실시간 업데이트 가능성 있음**
- 신용평가사가 **부도 직전에 등급 하향** 조정
- 만약 부도 발표 **후** 등급이 하향되었다면 → **누수 위험**

**통계:**
- 정상기업 중앙값: 5.0
- 부도기업 중앙값: 7.0
- AUC: 0.823 (매우 높은 단변량 예측력)

**검증 필요:**
- 신용등급 데이터의 **측정 시점** 확인
- 2021년 8월 기준으로 부도는 "향후 1년 내" → 2022년 8월까지
- 신용등급이 2021년 8월 **이후**에 업데이트되었다면 누수!

---

## 🚨 데이터 누수 가능성 평가

### ❌ 직접적인 누수는 아님
- 모든 구성 요소가 부도 **전**에 발생 가능한 사건
- "부도 여부"를 직접 포함하지 않음

### ⚠️ 간접적인 누수 가능성 (중간)
**시나리오 1: 신용등급 타이밍 문제**
- 만약 신용평가사가 **부도 직전 1~2주**에 등급을 하향했다면
- 실질적으로는 "부도 발표 직전 신호"를 포함 → **유사 누수**

**시나리오 2: 정보 비대칭**
- 연체, 체납, 법적리스크는 **공공 정보**
- 실무에서는 이 정보를 부도 예측에 사용 가능
- 하지만 ML 모델이 **과도하게 의존**하면 일반화 어려움

---

## 📈 특성 중요도 분석 (Part 2 결과)

### Information Value (IV)
```
이해관계자_불신지수:  2.205  (과적합 위험)
신용등급점수:        1.667  (과적합 위험)
연체심각도:         1.030  (과적합 위험)
```

**해석:**
- IV > 0.5: 과적합 위험
- **이 특성들은 너무 강력해서 모델이 과의존**
- 실제 배포 시 성능 하락 가능성

### VIF (다중공선성)
```
이해관계자_불신지수:  1.0e+15  (극심한 다중공선성)
세금체납리스크:      7.5e+14
신용등급점수:        3.8e+13
```

**해석:**
- VIF > 10: 다중공선성 문제
- **이 특성은 다른 특성들과 완벽한 선형 관계**
- L1 정규화가 다른 특성을 제거한 이유!

---

## 💡 결론 및 권장사항

### ✅ 데이터 누수 여부
**결론:** **직접적인 누수는 아니지만, 실무적으로는 "부도 직전 신호" 종합 지표**

**근거:**
1. 모든 구성 요소가 부도 전에 측정 가능
2. 하지만 **부도와 매우 가까운 시점**의 신호 (1~3개월 전)
3. 신용등급 타이밍만 추가 검증 필요

---

### 🚨 실무적 문제점

#### 1. 과적합 위험 (IV 2.2 > 0.5)
- 학습 데이터에서는 AUC 0.858로 매우 높지만
- **새로운 데이터에서는 성능 급락 가능**

#### 2. 극심한 다중공선성 (VIF 1e+15)
- 다른 27개 특성과 높은 상관관계
- **L1 정규화가 다른 특성을 억제한 근본 원인**

#### 3. 실무 배포 시 한계
- 연체/체납 정보는 **실시간 업데이트 어려움**
- 신용등급은 월 1회 또는 분기 1회 업데이트
- 예측 시점과 데이터 시점의 **시차 문제**

---

## 🎯 개선 방향

### Option 1: 이 특성 제외하고 재학습 ✅ (권장)
```python
X_without_distrust = X.drop(columns=['이해관계자_불신지수'])
# 다른 27개 특성만으로 모델 학습
# → 일반화 성능 개선 예상
```

**기대 효과:**
- PR-AUC 하락 가능 (0.16 → 0.12~0.14)
- 하지만 **다른 특성들의 역할 증대**
- **실무 배포 시 안정적인 성능**

### Option 2: 가중치 감소 ✅
```python
# 현재: 연체여부*2 + 세금체납*5 + 법적*3 + 신용등급/2
# 개선: 가중치 균등화
이해관계자_불신지수_v2 = (
    연체여부 * 1 +           # 2 → 1
    세금체납리스크 / 5 +     # 5 → 1
    법적리스크 / 3 +         # 3 → 1
    신용등급점수 / 10        # /2 → /10
)
```

### Option 3: 구성 요소 개별 사용 ✅ (가장 권장)
```python
# 이해관계자_불신지수 대신 개별 특성 사용
features = [
    '연체여부',
    '세금체납리스크',
    '법적리스크',
    '신용등급점수'
]
# → 모델이 각 특성의 가중치를 자동 학습
# → 다중공선성 해소
```

**기대 효과:**
- VIF 1e+15 → VIF < 10 (다중공선성 해소)
- L2 정규화와 조합 시 **모든 특성 활용**
- 해석력 개선

---

## 📋 다음 검증 단계

1. **신용등급 측정 시점 확인**
   - 원본 데이터에서 `신용평가등급` 컬럼의 날짜 확인
   - 2021년 8월 이전 데이터인지 검증

2. **이 특성 제외 실험**
   - L2 정규화로 재학습
   - Val PR-AUC 비교 (0.16 vs ?)

3. **구성 요소 개별 사용 실험**
   - 4개 특성을 개별로 모델에 입력
   - 계수 분포 확인

---

**작성일:** 2025-11-22
**검증자:** Claude (AI Senior Data Scientist)
**결론:** 직접적 누수는 아니지만, 과적합 위험 및 다중공선성 문제로 개선 필요
